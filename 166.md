可以的！  
SAP 的「料號」通常指 **物料主檔（Material Master）**，核心欄位分散在多個標準表，例如：

*   **MARA**：物料的一般資料（全域層級）
*   **MAKT**：物料描述（多語系）
*   **MARM**：物料的計量單位與換算
*   **MVKE**：銷售視圖（銷售組織/通路層級）
*   **MBEW**：評價與成本（公司代碼/評價範圍層級）

以下我先整理一個常用且「足以支援大多數企業流程」的 PostgreSQL schema，對應上述 SAP 結構。你可以直接用這些 DDL 建表，之後再依你們公司實務上的視圖需求擴充欄位即可。

***

## Postgres 建議資料模型（對應 SAP 物料主檔）

### 1) `materials`（對應 MARA：物料的一般資料）

```sql
CREATE TABLE public.materials (
    material_id          VARCHAR(40)  PRIMARY KEY,        -- SAP MATNR（物料號），可用字元版以容納前導零
    material_type        VARCHAR(4)   NOT NULL,           -- MTART
    industry_sector      VARCHAR(1)   NOT NULL,           -- MBRSH
    base_uom             VARCHAR(3)   NOT NULL,           -- MEINS（基本計量單位，如 'EA','KG'）
    old_material_number  VARCHAR(18),                      -- BISMT（舊料號）
    product_hierarchy    VARCHAR(18),                      -- PRDHA（產品階層）
    gross_weight         NUMERIC(15,3),                    -- BRGEW
    net_weight           NUMERIC(15,3),                    -- NTGEW
    weight_uom           VARCHAR(3),                       -- GEWEI（重量單位）
    volume               NUMERIC(15,3),                    -- VOLUM
    volume_uom           VARCHAR(3),                       -- VOLEH（容量單位）
    size_dimensions      VARCHAR(50),                      -- GROES（尺寸）
    material_group       VARCHAR(9),                       -- MATKL
    division             VARCHAR(2),                       -- SPART
    created_on           DATE,                             -- ERSDA
    created_by           VARCHAR(12),                      -- ERNAM
    status_general       VARCHAR(2),                       -- MSTAE（一般狀態）
    cross_plant_status   VARCHAR(2),                       -- MVKZA（示例，實際依公司用欄位）
    deletion_flag        BOOLEAN DEFAULT FALSE,            -- LVORM（刪除標記）
    -- 你可視需求增加更多 MARA 欄位：如危標、序號管理、批次管理等

    -- 欄位檢核
    CONSTRAINT chk_weight_pos CHECK (gross_weight IS NULL OR gross_weight >= 0),
    CONSTRAINT chk_weight_pos2 CHECK (net_weight IS NULL OR net_weight >= 0),
    CONSTRAINT chk_volume_pos CHECK (volume IS NULL OR volume >= 0)
);

CREATE INDEX idx_materials_type ON public.materials(material_type);
CREATE INDEX idx_materials_group ON public.materials(material_group);
CREATE INDEX idx_materials_product_hierarchy ON public.materials(product_hierarchy);
```

### 2) `material_texts`（對應 MAKT：物料描述，多語系）

```sql
CREATE TABLE public.material_texts (
    material_id   VARCHAR(40)  NOT NULL,
    language      VARCHAR(2)   NOT NULL,       -- SPRAS（ISO 語言碼，例：'EN','ZH'）
    description   VARCHAR(100) NOT NULL,       -- MAKTG（物料描述）

    PRIMARY KEY (material_id, language),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE INDEX idx_material_texts_desc ON public.material_texts(description);
```

### 3) `material_uoms`（對應 MARM：替代/輔助單位與換算）

```sql
CREATE TABLE public.material_uoms (
    material_id     VARCHAR(40) NOT NULL,
    alt_uom         VARCHAR(3)  NOT NULL,           -- 例如 'BOX','PAC'
    numerator       NUMERIC(15,5) NOT NULL,         -- UMREZ（換算分子）
    denominator     NUMERIC(15,5) NOT NULL,         -- UMREN（換算分母）
    ean             VARCHAR(18),                     -- EAN/GTIN（國際條碼）
    ean_category    VARCHAR(2),                      -- EAN11 類型（視需求）
    length          NUMERIC(15,3),                   -- LANEK（長）
    width           NUMERIC(15,3),                   -- BREIT（寬）
    height          NUMERIC(15,3),                   -- HOEHE（高）
    dim_uom         VARCHAR(3),                      -- 區分長寬高的單位，如 'MM','CM'
    packaging_mat   VARCHAR(18),                     -- 包材料號（若用到包裝階層）

    PRIMARY KEY (material_id, alt_uom),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id) ON UPDATE CASCADE ON DELETE CASCADE,
    CONSTRAINT chk_uom_ratio CHECK (numerator > 0 AND denominator > 0)
);

CREATE INDEX idx_material_uoms_ean ON public.material_uoms(ean);
```

### 4) `material_sales`（對應 MVKE：銷售視圖，依銷售組織/通路）

```sql
CREATE TABLE public.material_sales (
    material_id        VARCHAR(40) NOT NULL,
    sales_org          VARCHAR(4)  NOT NULL,          -- VKORG
    distribution_chan  VARCHAR(2)  NOT NULL,          -- VTWEG
    delivering_plant   VARCHAR(4),                     -- DWERK
    item_category      VARCHAR(4),                     -- MTPOS
    pricing_ref_mat    VARCHAR(40),                    -- KREF（定價參考料）
    sales_status       VARCHAR(2),                     -- VMSTA
    min_order_qty      NUMERIC(15,3),
    sales_uom          VARCHAR(3),                     -- VRKME
    tax_class          VARCHAR(1),                     -- TAXM1（示例）
    deletion_flag      BOOLEAN DEFAULT FALSE,

    PRIMARY KEY (material_id, sales_org, distribution_chan),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id) ON UPDATE CASCADE ON DELETE CASCADE,
    CONSTRAINT chk_min_order_qty CHECK (min_order_qty IS NULL OR min_order_qty >= 0)
);

CREATE INDEX idx_material_sales_status ON public.material_sales(sales_status);
```

### 5) `material_valuation`（對應 MBEW：評價/成本，依公司代碼或評價區）

```sql
CREATE TABLE public.material_valuation (
    material_id        VARCHAR(40) NOT NULL,
    valuation_area     VARCHAR(4)  NOT NULL,          -- BWKEY（公司代碼或工廠，依設定）
    valuation_class    VARCHAR(4)  NOT NULL,          -- BKLAS
    price_control      VARCHAR(1)  NOT NULL,          -- VPRSV（'S' 標準價、'V' 移動平均）
    standard_price     NUMERIC(15,5),                 -- STPRS
    moving_avg_price   NUMERIC(15,5),                 -- VERPR
    currency           VARCHAR(3)  NOT NULL,          -- WAERS
    last_change_date   DATE,                          -- LAEDA
    deletion_flag      BOOLEAN DEFAULT FALSE,

    PRIMARY KEY (material_id, valuation_area),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id) ON UPDATE CASCADE ON DELETE CASCADE,
    CONSTRAINT chk_prices_nonneg CHECK (
        (standard_price IS NULL OR standard_price >= 0) AND
        (moving_avg_price IS NULL OR moving_avg_price >= 0)
    )
);

CREATE INDEX idx_material_valuation_class ON public.material_valuation(valuation_class);
```

> 如果你們也使用工廠視圖（如 MARD 庫存、MRP、採購、儲存條件等），可以後續加上：
>
> *   `material_plant`（對應 MARC）
> *   `material_storage`（對應 MARD）
> *   `material_purchase`（對應 EINA/EINE、或 MARA/MARC 相關採購欄位）
> *   `material_mrp`（MRP 類型、批量大小、補貨策略等）

***

## 設計說明與注意事項

1.  **料號欄位型別**
    *   建議用 `VARCHAR(40)` 存 SAP 的 MATNR（S/4HANA 擴至 40 位），並**保留前導零**，避免轉為數值造成資料不一致。
2.  **多語系描述**
    *   描述放在 `material_texts`，以 `(material_id, language)` 做主鍵，符合 MAKT 的設計。
3.  **單位換算**
    *   基本單位在 `materials.base_uom`；替代單位與換算比例放在 `material_uoms`。換算遵循 SAP 的分子/分母邏輯（如 1 BOX = 10 EA → numerator=10, denominator=1）。
4.  **評價與幣別**
    *   `material_valuation` 加入 `price_control` 與 `currency`，在多公司代碼或以工廠為評價區時仍可正確分帳。
5.  **索引與一致性**
    *   針對常查詢欄位加索引（type、group、product\_hierarchy、valuation\_class 等）。
    *   刪除標記 `deletion_flag` 建議用 boolean，在應用層過濾，而非物理刪除。
6.  **與 SAP 整合**
    *   若未來要與 SAP 互通（例如透過 IDoc、API），欄位命名可保留 SAP 代碼於注釋中，便於映射。

***

## 你可能需要的延伸表（選配）

*   **`material_classification`**：對應 CLFY/CLASS/CHAR（特徵分類，行業常用），建議三表：`classes`、`characteristics`、`material_characteristics`（EAV 結構）。
*   **`material_images` / `document_links`**：對應 DMS（文件管理），存圖片、PDF 的連結或雜湊。
*   **`material_barcode`**：若條碼管理很細（每單位或包裝層級各自 GTIN），可獨立出表而非放在 `material_uoms`。

***

## 下一步需要你的資訊

為了讓 DDL 更貼近你們現況，我想確認幾點：

1.  你們是 **ECC** 還是 **S/4HANA**？（料號長度與某些視圖欄位會不同）
2.  目前用到的視圖有哪些？（一般/銷售/採購/工廠/儲存/會計/分類）
3.  是否需要 **工廠層級**（MARC/MARD）與 **MRP** 欄位？
4.  是否需要 **序號管理 / 批次管理**（如記錄批號、有效期）？
5.  是否要加上 **多語系**以外的 **多品牌/地區描述** 規則（例如繁中/简中分開）？

如果你把上述需求回覆我，我可以再幫你「加欄位、加索引、加約束」並提供 **完整的 Postgres DDL 檔**（含註解與範例資料）。





當然可以，Leo！下面我把 **ECC 與 S/4HANA** 同時考量，並且把你提到的 **「特性/屬性」**（classification/characteristics/attribute values）的資料模型一起設計成一套 **PostgreSQL DDL**。這份 schema 能支援：

*   料號長度差異（ECC：最多 18；S/4HANA：最多 40）
*   常用的物料主檔視圖（一般、語系描述、單位與換算、銷售、評價/成本）
*   **分類（Class）與特性（Characteristic）定義**、**特性值（Characteristic Values）目錄**、**物料的特性填報（EAV 模型）**
*   **多語系文本**（物料、分類、特性、特性值）

也同時提供命名建議：

*   **「Classification / Class（分類/類別）」**：對應 SAP KLAH/KLART
*   **「Characteristic（特性）」**：對應 SAP CABN
*   **「Characteristic Value（特性值）」**：對應 SAP CAWN（值目錄）與 AUSP（已指派值）
*   「Attribute」在許多系統也被用來指「特性」，但若要與 SAP 對齊且降低溝通成本，**建議用「Characteristic（特性）」與「Characteristic Value（特性值）」**。

***

## 1) 核心物料主檔（同時支援 ECC 與 S/4HANA）

> 說明：`material_id` 用 `VARCHAR(40)`，可存 S/4 的 40 位，也能存 ECC 的 18 位。**保留前導零**。

```sql
-- 方便統一枚舉型別（後面 EAV 會用到）
CREATE TYPE public.characteristic_datatype AS ENUM (
    'CHAR',      -- 字元/文字型（對應 SAP: CHAR）
    'NUM',       -- 數值型（SAP: NUM）
    'DATE',      -- 日期（SAP: DATE）
    'BOOL',      -- 布林（SAP: CHAR(1) with domain Y/N 或 X/space）
    'CURR'       -- 金額（數值＋幣別）
);

-- 物料主檔（對應 MARA）
CREATE TABLE public.materials (
    material_id          VARCHAR(40)  PRIMARY KEY,    -- SAP MATNR（ECC ≤18；S/4 ≤40）
    material_type        VARCHAR(4)   NOT NULL,       -- MTART
    industry_sector      VARCHAR(1)   NOT NULL,       -- MBRSH
    base_uom             VARCHAR(3)   NOT NULL,       -- MEINS
    old_material_number  VARCHAR(18),                  -- BISMT
    product_hierarchy    VARCHAR(18),                  -- PRDHA
    material_group       VARCHAR(9),                   -- MATKL
    division             VARCHAR(2),                   -- SPART
    gross_weight         NUMERIC(15,3),                -- BRGEW
    net_weight           NUMERIC(15,3),                -- NTGEW
    weight_uom           VARCHAR(3),                   -- GEWEI
    volume               NUMERIC(15,3),                -- VOLUM
    volume_uom           VARCHAR(3),                   -- VOLEH
    size_dimensions      VARCHAR(50),                  -- GROES
    created_on           DATE,                         -- ERSDA
    created_by           VARCHAR(12),                  -- ERNAM
    status_general       VARCHAR(2),                   -- MSTAE（範例）
    deletion_flag        BOOLEAN DEFAULT FALSE,        -- LVORM

    CONSTRAINT chk_weight_pos CHECK (gross_weight IS NULL OR gross_weight >= 0),
    CONSTRAINT chk_weight_pos2 CHECK (net_weight IS NULL OR net_weight >= 0),
    CONSTRAINT chk_volume_pos CHECK (volume IS NULL OR volume >= 0)
);

CREATE INDEX idx_materials_type ON public.materials(material_type);
CREATE INDEX idx_materials_group ON public.materials(material_group);
CREATE INDEX idx_materials_product_hierarchy ON public.materials(product_hierarchy);

-- 物料描述（對應 MAKT，多語系）
CREATE TABLE public.material_texts (
    material_id   VARCHAR(40)  NOT NULL,
    language      VARCHAR(2)   NOT NULL,       -- ISO 語言碼，例：'EN','ZH'
    description   VARCHAR(100) NOT NULL,       -- MAKTG

    PRIMARY KEY (material_id, language),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE INDEX idx_material_texts_desc ON public.material_texts(description);

-- 單位與換算（對應 MARM）
CREATE TABLE public.material_uoms (
    material_id     VARCHAR(40) NOT NULL,
    alt_uom         VARCHAR(3)  NOT NULL,
    numerator       NUMERIC(15,5) NOT NULL,   -- UMREZ
    denominator     NUMERIC(15,5) NOT NULL,   -- UMREN
    ean             VARCHAR(18),               -- EAN/GTIN
    ean_category    VARCHAR(2),
    length          NUMERIC(15,3),
    width           NUMERIC(15,3),
    height          NUMERIC(15,3),
    dim_uom         VARCHAR(3),
    packaging_mat   VARCHAR(18),

    PRIMARY KEY (material_id, alt_uom),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id) ON UPDATE CASCADE ON DELETE CASCADE,
    CONSTRAINT chk_uom_ratio CHECK (numerator > 0 AND denominator > 0)
);

CREATE INDEX idx_material_uoms_ean ON public.material_uoms(ean);

-- 銷售視圖（對應 MVKE）
CREATE TABLE public.material_sales (
    material_id        VARCHAR(40) NOT NULL,
    sales_org          VARCHAR(4)  NOT NULL,      -- VKORG
    distribution_chan  VARCHAR(2)  NOT NULL,      -- VTWEG
    delivering_plant   VARCHAR(4),                 -- DWERK
    item_category      VARCHAR(4),                 -- MTPOS
    pricing_ref_mat    VARCHAR(40),                -- KREF
    sales_status       VARCHAR(2),                 -- VMSTA
    min_order_qty      NUMERIC(15,3),
    sales_uom          VARCHAR(3),                 -- VRKME
    tax_class          VARCHAR(1),                 -- 範例 TAXM1
    deletion_flag      BOOLEAN DEFAULT FALSE,

    PRIMARY KEY (material_id, sales_org, distribution_chan),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id) ON UPDATE CASCADE ON DELETE CASCADE,
    CONSTRAINT chk_min_order_qty CHECK (min_order_qty IS NULL OR min_order_qty >= 0)
);

CREATE INDEX idx_material_sales_status ON public.material_sales(sales_status);

-- 會計/評價（對應 MBEW）
-- 註：S/4HANA 多數公司預設 valuation area = plant（工廠），但也有公司代碼層級；此處保留彈性。
CREATE TABLE public.material_valuation (
    material_id        VARCHAR(40) NOT NULL,
    valuation_area     VARCHAR(4)  NOT NULL,      -- BWKEY（公司代碼或工廠）
    valuation_class    VARCHAR(4)  NOT NULL,      -- BKLAS
    price_control      VARCHAR(1)  NOT NULL,      -- VPRSV（'S' 標準價、'V' 移動平均）
    standard_price     NUMERIC(15,5),             -- STPRS
    moving_avg_price   NUMERIC(15,5),             -- VERPR
    currency           VARCHAR(3)  NOT NULL,      -- WAERS
    last_change_date   DATE,                      -- LAEDA
    deletion_flag      BOOLEAN DEFAULT FALSE,

    PRIMARY KEY (material_id, valuation_area),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id) ON UPDATE CASCADE ON DELETE CASCADE,
    CONSTRAINT chk_prices_nonneg CHECK (
        (standard_price IS NULL OR standard_price >= 0) AND
        (moving_avg_price IS NULL OR moving_avg_price >= 0)
    )
);

CREATE INDEX idx_material_valuation_class ON public.material_valuation(valuation_class);
```

> 延伸視圖（選配）：工廠層級（MARC）、庫存地點/倉別（MARD）、採購（EINA/EINE 或 MARA/MARC 欄位）、MRP 等，若你要我加，我可以補上。

***

## 2) 分類與特性（Class & Characteristics）＋ 特性值（Characteristic Values）

> 設計重點：
>
> *   **Class（類別）**：定義分群（常用 `class_type='001'` 表示物料）。
> *   **Characteristic（特性）**：定義欄位的「型別/單位/允許值」。
> *   **Characteristic Value（特性值目錄）**：枚舉值（選單），對應 SAP CAWN。
> *   **EAV（Entity–Attribute–Value）**：物料填報特性值，支援多型別、可重複、多語系描述。
> *   **多語系文本**：Class / Characteristic / Value 都可有文本。

```sql
-- 類別（對應 KLAH）
CREATE TABLE public.classes (
    class_id        VARCHAR(18) PRIMARY KEY,   -- KLAH-CLINT 或可用外部自編碼
    class_type      VARCHAR(3)  NOT NULL,      -- KLART（物料常用 '001'）
    status          VARCHAR(2),                -- KLAH-STAT（範例）
    valid_from      DATE,
    valid_to        DATE
);

-- 類別文本（多語系）
CREATE TABLE public.class_texts (
    class_id    VARCHAR(18) NOT NULL,
    language    VARCHAR(2)  NOT NULL,
    name        VARCHAR(60) NOT NULL,
    description TEXT,

    PRIMARY KEY (class_id, language),
    FOREIGN KEY (class_id) REFERENCES public.classes(class_id) ON UPDATE CASCADE ON DELETE CASCADE
);

-- 特性定義（對應 CABN）
CREATE TABLE public.characteristics (
    characteristic_id   VARCHAR(18) PRIMARY KEY,   -- CABN-ATINN 或自編
    characteristic_code VARCHAR(30) UNIQUE,        -- CABN-ATNAM（人類可讀代碼）
    data_type           public.characteristic_datatype NOT NULL,
    unit_of_measure     VARCHAR(3),                -- 對應特性之計量單位（如 'MM','KG'）
    length              INTEGER,                   -- 對於 CHAR 型別可設定最大長度
    decimals            INTEGER,                   -- 對於 NUM/CURR 可設定小數位
    multi_valued        BOOLEAN DEFAULT FALSE,     -- 是否允許多重值（SAP: 值多重）
    allow_value_catalog BOOLEAN DEFAULT FALSE      -- 是否使用值目錄（SAP: CAWN）
);

-- 特性文本（多語系）
CREATE TABLE public.characteristic_texts (
    characteristic_id  VARCHAR(18) NOT NULL,
    language           VARCHAR(2)  NOT NULL,
    name               VARCHAR(60) NOT NULL,
    description        TEXT,

    PRIMARY KEY (characteristic_id, language),
    FOREIGN KEY (characteristic_id) REFERENCES public.characteristics(characteristic_id)
        ON UPDATE CASCADE ON DELETE CASCADE
);

-- 特性值目錄（對應 CAWN/CAWNT），供枚舉/選單型特性使用
CREATE TABLE public.characteristic_value_catalog (
    value_id           VARCHAR(24) PRIMARY KEY,   -- CAWN-ATZHL 或自編
    characteristic_id  VARCHAR(18) NOT NULL,
    value_code         VARCHAR(40) NOT NULL,      -- 可存技術碼（例：'RED','BLUE'）
    sort_order         INTEGER,

    FOREIGN KEY (characteristic_id) REFERENCES public.characteristics(characteristic_id)
        ON UPDATE CASCADE ON DELETE CASCADE,
    UNIQUE (characteristic_id, value_code)
);

CREATE TABLE public.characteristic_value_texts (
    value_id    VARCHAR(24) NOT NULL,
    language    VARCHAR(2)  NOT NULL,
    name        VARCHAR(60) NOT NULL,
    description TEXT,

    PRIMARY KEY (value_id, language),
    FOREIGN KEY (value_id) REFERENCES public.characteristic_value_catalog(value_id)
        ON UPDATE CASCADE ON DELETE CASCADE
);

-- 物料指派至類別（對應 KSSK，class_type='001'）
CREATE TABLE public.material_class_assignments (
    material_id  VARCHAR(40) NOT NULL,
    class_id     VARCHAR(18) NOT NULL,
    assigned_on  DATE DEFAULT CURRENT_DATE,

    PRIMARY KEY (material_id, class_id),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (class_id) REFERENCES public.classes(class_id)
        ON UPDATE CASCADE ON DELETE CASCADE
);

-- 物料的特性填報（對應 AUSP：EAV 結構）
-- 支援單值/多值，亦支援不同型別（CHAR/NUM/DATE/BOOL/CURR）
CREATE TABLE public.material_characteristic_values (
    material_id        VARCHAR(40) NOT NULL,
    class_id           VARCHAR(18) NOT NULL,  -- 可選擇是否強制每個值一定屬於某類別
    characteristic_id  VARCHAR(18) NOT NULL,
    sequence_no        INTEGER      DEFAULT 1, -- 若 multi_valued 則用 sequence 區分多個值
    data_type          public.characteristic_datatype NOT NULL,
    -- 實際值欄位：只允許其中一種型別被填
    string_value       TEXT,
    number_value       NUMERIC(30,10),
    date_value         DATE,
    bool_value         BOOLEAN,
    currency_value     NUMERIC(30,10),
    currency_code      VARCHAR(3),            -- ISO 幣別，搭配 CURR 型別使用
    value_catalog_id   VARCHAR(24),           -- 若使用枚舉，指向 characteristic_value_catalog
    valid_from         DATE,
    valid_to           DATE,
    source_system      VARCHAR(20),           -- 來源系統（如 'ECC','S4','PLM'）
    last_changed_at    TIMESTAMP,

    PRIMARY KEY (material_id, class_id, characteristic_id, sequence_no),
    FOREIGN KEY (material_id) REFERENCES public.materials(material_id)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (class_id) REFERENCES public.classes(class_id)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (characteristic_id) REFERENCES public.characteristics(characteristic_id)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (value_catalog_id) REFERENCES public.characteristic_value_catalog(value_id)
        ON UPDATE CASCADE ON DELETE SET NULL,

    -- 僅允許一種類型的實際值被填（或是枚舉值）
    CONSTRAINT chk_single_value
    CHECK (
        (
          (string_value IS NOT NULL)::int +
          (number_value IS NOT NULL)::int +
          (date_value   IS NOT NULL)::int +
          (bool_value   IS NOT NULL)::int +
          (currency_value IS NOT NULL)::int +
          (value_catalog_id IS NOT NULL)::int
        ) = 1
    ),

    -- 型別一致性檢核
    CONSTRAINT chk_datatype_consistency
    CHECK (
        (data_type = 'CHAR' AND string_value IS NOT NULL AND value_catalog_id IS NULL)
        OR (data_type = 'NUM'  AND number_value IS NOT NULL)
        OR (data_type = 'DATE' AND date_value   IS NOT NULL)
        OR (data_type = 'BOOL' AND bool_value   IS NOT NULL)
        OR (data_type = 'CURR' AND currency_value IS NOT NULL AND currency_code IS NOT NULL)
        OR (value_catalog_id IS NOT NULL) -- 使用枚舉時可不看 data_type 具體值
    )
);

CREATE INDEX idx_mcv_material ON public.material_characteristic_values(material_id);
CREATE INDEX idx_mcv_char ON public.material_characteristic_values(characteristic_id);
CREATE INDEX idx_mcv_class ON public.material_characteristic_values(class_id);
CREATE INDEX idx_mcv_catalog ON public.material_characteristic_values(value_catalog_id);
```

> 若你們要**允許同一特性同時填「枚舉值＋自由填文字」**（許多企業會同時記錄標準值與備註），可以把 `chk_single_value` 放寬，或改為「至少一種值」。目前是**強制單一選擇**以避免資料混亂。

***

## 3) 命名與對應（SAP ↔ PostgreSQL）

*   **Class（類別）**：`classes` / `class_texts` ↔ SAP **KLAH/KLART**
*   **Characteristic（特性）**：`characteristics` / `characteristic_texts` ↔ SAP **CABN**（ATNAM/ATINN）
*   **Characteristic Value（特性值目錄）**：`characteristic_value_catalog` / `characteristic_value_texts` ↔ SAP **CAWN/CAWNT**
*   **Material-Class 指派**：`material_class_assignments` ↔ SAP **KSSK**（class\_type 通常為 '001' 表物料）
*   **Material 的特性值**：`material_characteristic_values` ↔ SAP **AUSP**（物料 OBJEK 的特性值）

> **Variant Configuration（可選）**：若你們有 LO‑VC（型號配置），會多出 **CUOBJ**、**dependencies**、**configuration profiles** 等，資料模型要再加一層「配置實例」。有需要我可以加「`configuration_instances` / `instance_characteristic_values`」這組表。

***

## 4) ECC 與 S/4HANA 差異的處理建議

1.  **物料號長度**：`material_id VARCHAR(40)` 即可同時容納 ECC（≤18）與 S/4（≤40）。
2.  **評價區（valuation area）**：S/4 常見以 **工廠**為評價區（但公司設定可能不同），`material_valuation.valuation_area` 保留彈性。
3.  **會計/庫存交易表**：S/4 的交易資料多改為 **MATDOC**（影響報表/存查），但**主檔**仍沿用 MARA/MARC/MARM/MAKT/MVKE/MBEW。此 schema 聚焦主檔，不含交易。
4.  **分類/特性**：ECC 與 S/4 的分類模型概念相同，差異在技術細節（如 ATINN/CLINT 編碼、長度），本 schema 以**通用鍵值**設計，匯入時保留原始 ID 於欄位即可。

***

## 5) ETL 對應與匯入指引（摘要）

*   **物料**：MARA → `materials`；MAKT → `material_texts`；MARM → `material_uoms`；MVKE → `material_sales`；MBEW → `material_valuation`
*   **分類**：KLAH/KLART → `classes`、`class_texts`
*   **特性**：CABN/ATNAM/ATINN → `characteristics`、`characteristic_texts`
*   **特性值目錄**：CAWN/CAWNT → `characteristic_value_catalog`、`characteristic_value_texts`
*   **指派**：KSSK（OBJEK=物料號；KLART='001'）→ `material_class_assignments`
*   **物料的特性值**：AUSP（依 OBJEK & ATINN 抽出值，轉型填入 `material_characteristic_values` 的對應欄位）

> 匯入時要注意 **OBJEK 對應物料號的填充規則**（前導零與寬度），避免對不上；必要時可用一張中介對照表（如 SAP `INOB`）確保 mapping 一致。

***

## 6) 實務規則建議

*   **多語系策略**：文本表用 `(id, language)` 做主鍵，對齊 SAP 設計；可加 `DEFAULT 'EN'` 或依地區策略。
*   **值一致性**：`material_characteristic_values.data_type` 與實際值欄位有一致性檢核；枚舉值時填 `value_catalog_id`。
*   **多值特性**：用 `sequence_no` 做排序與去重；若需保證「不可重複相同枚舉」可加 `UNIQUE (material_id, class_id, characteristic_id, value_catalog_id)` 條件索引。
*   **查詢效能**：針對常用查詢（物料→特性、特性→物料、類別→物料）加索引已示範，必要時可加 **部份索引** 或 **物化檢視**。
*   **主檔/交易分離**：本 schema 只處理 master data；若要做條碼/包裝階層（EAN/SSCC）或文件（DMS）可再擴充。

***

## 接下來我可以為你調整的方向

為了更貼近你們的現況與落地使用，我想確認幾點（你回覆我後，我會把 DDL 再「精準化」：加欄位、加約束、加範例資料/視圖）：

1.  你們目前 **有使用 LO‑VC（型號配置）** 嗎？需要「配置實例」與「依配置生成 BOM/工單」的表嗎？
2.  是否需要 **工廠（MARC）/庫存地點（MARD）/採購視圖** 的欄位與 DDL？
3.  特性值是否 **允許同時枚舉＋自由文字**（例如「顏色=RED」同時備註「Pantone 185C」）？
4.  多語系是否需要 **繁中/简中** 分開存？是否要加地區別名（如市場名稱、包裝名）？
5.  你們的 valuation area 是 **公司代碼** 還是 **工廠**？要不要加 **分帳**、**幣別換算** 或 **期間有效性**？

只要你告訴我這幾點，我就把 schema 完整打磨到你們的使用場景，並提供 **一份可直接執行的 .sql 檔**（含註解與初始化例子）。
