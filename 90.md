å¥½çš„ï¼Œæˆ‘å€‘ä¾†è©³ç´°è¬›è§£ `gcloud services enable compute.googleapis.com` é€™å€‹æŒ‡ä»¤ï¼š

### æŒ‡ä»¤ä½œç”¨
é€™å€‹æŒ‡ä»¤ç”¨æ–¼åœ¨ **Google Cloud Platform (GCP)** çš„ç•¶å‰å°ˆæ¡ˆä¸­ **å•Ÿç”¨ Compute Engine API æœå‹™**ã€‚ç°¡å–®ä¾†èªªï¼Œå®ƒæ˜¯ä½¿ç”¨ GCP è™›æ“¬æ©Ÿå™¨ï¼ˆVMï¼‰æœå‹™çš„å¿…è¦æº–å‚™æ­¥é©Ÿã€‚

---

### æŒ‡ä»¤æ‹†è§£
| éƒ¨åˆ† | èªªæ˜ |
|------|------|
| `gcloud` | Google Cloud SDK çš„å‘½ä»¤åˆ—å·¥å…· |
| `services` | ç®¡ç† GCP API æœå‹™çš„å­å‘½ä»¤ç¾¤çµ„ |
| `enable` | å•Ÿç”¨æŒ‡å®šæœå‹™çš„æ“ä½œ |
| `compute.googleapis.com` | **Compute Engine API çš„æ­£å¼æœå‹™åç¨±** |

---

### ç‚ºä»€éº¼éœ€è¦é€™å€‹æŒ‡ä»¤ï¼Ÿ
1. **æ¬Šé™æ§åˆ¶**ï¼šGCP é è¨­æ‰€æœ‰ API éƒ½æ˜¯é—œé–‰ç‹€æ…‹ï¼Œéœ€æ‰‹å‹•å•Ÿç”¨ï¼ˆå®‰å…¨èˆ‡æˆæœ¬è€ƒé‡ï¼‰ã€‚
2. **ä½¿ç”¨ Compute Engine çš„å‰æ**ï¼š
   - å»ºç«‹/ç®¡ç†è™›æ“¬æ©Ÿå™¨ï¼ˆVMï¼‰
   - ä½¿ç”¨è² è¼‰å¹³è¡¡å™¨ã€ç£ç¢Ÿã€å¿«ç…§ç­‰åŠŸèƒ½
   - æ“ä½œå¯¦ä¾‹ç¾¤çµ„ï¼ˆInstance Groupsï¼‰
3. **è¨ˆè²»è§¸ç™¼é»**ï¼šå•Ÿç”¨æœå‹™å¾Œï¼Œå¯¦éš›ä½¿ç”¨è³‡æºæ‰æœƒé–‹å§‹è¨ˆè²»ï¼ˆå•Ÿç”¨æœ¬èº«å…è²»ï¼‰ã€‚

---

### åŸ·è¡Œæ­¥é©Ÿ
1. **å®‰è£ Google Cloud SDK**  
   [å®˜æ–¹å®‰è£æŒ‡å¼•](https://cloud.google.com/sdk/docs/install)

2. **ç™»å…¥ä¸¦è¨­å®šå°ˆæ¡ˆ**ï¼ˆçµ‚ç«¯æ©ŸåŸ·è¡Œï¼‰
   ```bash
   gcloud auth login        # ç™»å…¥æ‚¨çš„ Google å¸³è™Ÿ
   gcloud config set project YOUR_PROJECT_ID  # æ›¿æ›ç‚ºæ‚¨çš„å°ˆæ¡ˆID
   ```

3. **åŸ·è¡Œå•Ÿç”¨æŒ‡ä»¤**
   ```bash
   gcloud services enable compute.googleapis.com
   ```

4. **é©—è­‰æ˜¯å¦å•Ÿç”¨æˆåŠŸ**
   ```bash
   gcloud services list --enabled | grep compute.googleapis.com
   ```
   è‹¥çœ‹åˆ°è¼¸å‡ºè¡¨ç¤ºå·²å•Ÿç”¨ã€‚

---

### å¸¸è¦‹æƒ…å¢ƒç¯„ä¾‹
#### æƒ…å¢ƒ 1ï¼šé¦–æ¬¡å»ºç«‹ VM å‰
```bash
# å•Ÿç”¨ Compute Engine API
gcloud services enable compute.googleapis.com

# å»ºç«‹ VM å¯¦ä¾‹
gcloud compute instances create my-vm --zone=us-central1-a
```

#### æƒ…å¢ƒ 2ï¼šè‡ªå‹•åŒ–è…³æœ¬ä¸­ç¢ºä¿æœå‹™å•Ÿç”¨
```bash
#!/bin/bash
# æª¢æŸ¥æœå‹™æ˜¯å¦å•Ÿç”¨ï¼Œè‹¥æœªå•Ÿç”¨å‰‡å•Ÿç”¨ä¹‹
if ! gcloud services list --enabled | grep -q compute.googleapis.com; then
  echo "å•Ÿç”¨ Compute Engine API..."
  gcloud services enable compute.googleapis.com
fi
```

---

### æ³¨æ„äº‹é …
1. **æ¬Šé™éœ€æ±‚**ï¼š  
   éœ€è¦å°ˆæ¡ˆçš„ `Service Usage Admin` æˆ– `Project Owner` è§’è‰²ã€‚
   
2. **å•Ÿç”¨æ™‚é–“**ï¼š  
   é€šå¸¸å¹¾ç§’å…§å®Œæˆï¼Œä½†é¦–æ¬¡å•Ÿç”¨å¯èƒ½éœ€ 1~2 åˆ†é˜ã€‚

3. **ç›¸é—œæœå‹™**ï¼š  
   è‹¥éœ€å®Œæ•´ä½¿ç”¨ Compute Engineï¼Œå»ºè­°ä¸€ä½µå•Ÿç”¨ï¼š
   ```bash
   gcloud services enable \
     compute.googleapis.com \
     cloudresourcemanager.googleapis.com \
     iam.googleapis.com
   ```

4. **æª¢è¦–æ‰€æœ‰å¯å•Ÿç”¨æœå‹™**ï¼š
   ```bash
   gcloud services list --available
   ```

---

### æ›¿ä»£åšæ³•
- **GCP æ§åˆ¶å°å•Ÿç”¨**ï¼š  
  å°è¦½è‡³ï¼š`API èˆ‡æœå‹™ > è³‡æ–™åº«` > æœå°‹ "Compute Engine API" > é»æ“Š `å•Ÿç”¨`

---

### é‡è¦æç¤º
âœ… **å°ˆæ¡ˆå±¤ç´šç”Ÿæ•ˆ**ï¼šå•Ÿç”¨å¾Œå°è©²å°ˆæ¡ˆå…§æ‰€æœ‰ä½¿ç”¨è€…é–‹æ”¾  
âš ï¸ **ä¸å¯é€†æ“ä½œ**ï¼šç„¡æ³•ã€Œåœç”¨ã€åªèƒ½ã€Œé—œé–‰è¨ˆè²»ã€ï¼ˆéœ€é€éæ”¯æ´ç”³è«‹ï¼‰  
ğŸ’¡ å•Ÿç”¨å¾Œä»é ˆ IAM æ¬Šé™æ‰èƒ½æ“ä½œè³‡æº

æŒæ¡é€™å€‹æŒ‡ä»¤å¾Œï¼Œæ‚¨å°±èƒ½é–‹å§‹åœ¨ GCP ä¸Šè‡ªç”±å‰µå»ºå’Œç®¡ç†è™›æ“¬æ©Ÿå™¨äº†ï¼

é—œæ–¼å•Ÿç”¨ `compute.googleapis.com`ï¼ˆCompute Engine APIï¼‰çš„æˆæœ¬ç–‘æ…®ï¼Œä»¥ä¸‹æ˜¯é—œéµåˆ†æèˆ‡å¯¦éš›å»ºè­°ï¼š

---

### âš ï¸ æ ¸å¿ƒåŸå‰‡ï¼š**ã€Œå•Ÿç”¨ API æœå‹™æœ¬èº«å®Œå…¨å…è²»ã€**
- **ä¸ç”¢ç”Ÿç›´æ¥è²»ç”¨**ï¼šå–®ç´”åŸ·è¡Œ `gcloud services enable compute.googleapis.com` **ä¸æœƒç”¢ç”Ÿä»»ä½•è²»ç”¨**ã€‚
- **å¾ŒçºŒæ“ä½œæ‰æœƒè¨ˆè²»**ï¼šåªæœ‰ç•¶æ‚¨**å¯¦éš›ä½¿ç”¨ Compute Engine è³‡æº**ï¼ˆå¦‚å»ºç«‹ VMã€ç£ç¢Ÿã€è² è¼‰å¹³è¡¡å™¨ç­‰ï¼‰æ™‚ï¼Œæ‰æŒ‰ç”¨é‡æ”¶è²»ã€‚

---

### ğŸ” æˆæœ¬é¢¨éšªä¾†æºï¼ˆéæŒ‡ä»¤æœ¬èº«ï¼Œè€Œæ˜¯å¾ŒçºŒæ“ä½œï¼‰
| **é¢¨éšªé¡å‹**       | **èªªæ˜**                                                                 | **é˜²ç¯„æªæ–½**                                                                 |
|--------------------|-------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| **æ„å¤–å•Ÿç”¨ä»˜è²»è³‡æº** | èª¤æ“ä½œå»ºç«‹ VM å¯¦ä¾‹ï¼ˆå°¤å…¶é«˜è¦æ ¼æ©Ÿå‹ï¼‰æˆ–é•·æœŸé‹è¡Œ                           | âœ”ï¸ è¨­å®š[é ç®—è­¦å ±](https://cloud.google.com/billing/docs/how-to/budgets) <br> âœ”ï¸ ä½¿ç”¨ `--preemptible` å»ºç«‹[å¯ä¸­æ–·VM](https://cloud.google.com/compute/docs/instances/preemptible) çœè²» |
| **é–’ç½®è³‡æºç´¯ç©è²»ç”¨** | å¿˜è¨˜é—œåœæ¸¬è©¦ç”¨çš„ VMã€ç£ç¢Ÿæˆ–ä¿ç•™ IP åœ°å€                                 | âœ”ï¸ å®šæœŸç”¨æŒ‡ä»¤æª¢æŸ¥é–’ç½®è³‡æºï¼š<br> `gcloud compute instances list` <br> `gcloud compute disks list` |
| **å¤–éƒ¨ IP åœ°å€è²»ç”¨** | å³ä½¿ VM é—œæ©Ÿï¼Œ**æœªè¢«ä½¿ç”¨çš„éœæ…‹å¤–éƒ¨ IP ä»æŒ‰[æ¯å°æ™‚è¨ˆè²»](https://cloud.google.com/vpc/network-pricing#ipaddress)** | âœ”ï¸ åˆªé™¤ä¸éœ€è¦çš„ IPï¼š<br> `gcloud compute addresses delete [IP_NAME]` |
| **æœ€ä½è¨ˆè²»å–®ä½**     | éƒ¨åˆ†è³‡æºæŒ‰ç§’è¨ˆè²»ä½†æœ‰æœ€ä½é–€æª»ï¼ˆä¾‹å¦‚ï¼šVM å¯¦ä¾‹æœ€ä½æŒ‰ 1 åˆ†é˜æ”¶è²»ï¼‰           | âœ”ï¸ çŸ­æœŸæ¸¬è©¦å¾Œç«‹å³åˆªé™¤è³‡æº                                                                 |

---

### ğŸ’¡ å¯¦å‹™å»ºè­°ï¼šå®‰å…¨å•Ÿç”¨ API ä¸”é¿å…æ„å¤–æˆæœ¬
1. **å…è²»é¡åº¦åˆ©ç”¨**ï¼ˆé¦–å¹´æ–°ç”¨æˆ¶ï¼‰ï¼š
   - GCP æä¾› [Always Free é¡åº¦](https://cloud.google.com/free/docs/gcp-free-tier)ï¼ŒåŒ…å«ï¼š
     - æ¯æœˆ 1 å° f1-micro VM (ç‰¹å®šå€åŸŸ)
     - 30GB æ¨™æº–ç£ç¢Ÿ
     - 5GB å¿«ç…§å„²å­˜
     - 1GB å¤–éƒ¨IPæµé‡

2. **å¼·åˆ¶å•Ÿç”¨é ç®—è­¦å ±**ï¼š
   ```bash
   # å»ºç«‹æ¯æœˆ $10 é ç®—è­¦å ±ï¼ˆæ›¿æ› [BILLING_ACCOUNT_ID]ï¼‰
   gcloud billing budgets create \
     --billing-account=[BILLING_ACCOUNT_ID] \
     --display-name="é˜²è¶…æ”¯ç›£æ§" \
     --budget-amount=10 \
     --threshold-rule=percent=0.5 \
     --threshold-rule=percent=0.9 \
     --filter-projects="[YOUR_PROJECT_ID]"
   ```

3. **æ¸¬è©¦å®Œç«‹å³æ¸…ç†**ï¼š
   ```bash
   # åˆªé™¤æ¸¬è©¦ç”¨ VM é€£åŒç£ç¢Ÿï¼ˆç¯„ä¾‹ï¼‰
   gcloud compute instances delete my-test-vm --zone=us-central1-a --delete-disks=all
   ```

4. **æ¬Šé™æœ€å°åŒ–åŸå‰‡**ï¼š
   - é¿å…ç›´æ¥è³¦äºˆé–‹ç™¼è€… `Project Owner` æ¬Šé™
   - æ”¹ç”¨ç²¾ç´°æ¬Šé™è§’è‰²ï¼ˆå¦‚ `Compute Instance Admin (v1)`ï¼‰

---

### âœ… å®‰å…¨å•Ÿç”¨æ“ä½œæµç¨‹ï¼ˆé›¶æˆæœ¬å‰æï¼‰
```bash
# 1. ç™»å…¥ & è¨­å®šå°ˆæ¡ˆ
gcloud auth login
gcloud config set project YOUR_SAFE_PROJECT_ID

# 2. å•Ÿç”¨ APIï¼ˆä»å…è²»ï¼‰
gcloud services enable compute.googleapis.com

# 3. ä½¿ç”¨å…è²»è³‡æºï¼ˆä¾‹å¦‚åœ¨ us-west1 å€åŸŸå»ºç«‹ f1-microï¼‰
gcloud compute instances create free-tier-vm \
  --machine-type=f1-micro \
  --zone=us-west1-a \
  --image-project=debian-cloud \
  --image-family=debian-12
```

---

### âš ï¸ é‡è¦æ³¨æ„
- **åˆªé™¤å°ˆæ¡ˆ = åœæ­¢æ‰€æœ‰è¨ˆè²»**ï¼šç•¶æ‚¨åˆªé™¤æ•´å€‹ GCP å°ˆæ¡ˆæ™‚ï¼Œ**æ‰€æœ‰é—œè¯è³‡æºæœƒç«‹å³åœæ­¢è¨ˆè²»**ï¼ˆæœ€å¾¹åº•çš„é˜²å‘†æ³•ï¼‰ã€‚
- **ç›£æ§å…¥å£**ï¼šéš¨æ™‚åœ¨ [GCP æˆæœ¬ç®¡ç†ä»‹é¢](https://console.cloud.google.com/billing/) æŸ¥çœ‹å³æ™‚èŠ±è²»ã€‚

> ğŸ’¡ **çµè«–ï¼šå–®ç´”å•Ÿç”¨ API ç„¡éœ€æ“”å¿ƒè²»ç”¨ï¼Œä½†å¾ŒçºŒæ“ä½œéœ€æ­é…æˆæœ¬ç®¡æ§æªæ–½ã€‚** æŒæ¡ã€Œç”¨å®Œå³åˆªã€åŸå‰‡ä¸¦è¨­å®šé ç®—è­¦å ±ï¼Œå³å¯å®‰å…¨æ¢ç´¢ Compute Engine åŠŸèƒ½ã€‚



é€™å€‹æŒ‡ä»¤ç”¨é€”æ˜¯ç‚ºæŒ‡å®š GCP å°ˆæ¡ˆ**åŒæ™‚å•Ÿç”¨å…©å€‹é—œéµæœå‹™**ï¼Œä»¥ä¸‹æ˜¯è©³ç´°è§£æï¼š

```bash
gcloud services enable servicenetworking.googleapis.com \
  container.googleapis.com --project=mai-today-dev
```

### æ ¸å¿ƒåŠŸèƒ½æ‹†è§£
| çµ„ä»¶ | èªªæ˜ |
|------|------|
| `servicenetworking.googleapis.com` | **Service Networking API** - ç®¡ç† VPC ç¶²çµ¡æœå‹™é€£æ¥ |
| `container.googleapis.com` | **Kubernetes Engine API (GKE)** - ç®¡ç† GKE å®¹å™¨é›†ç¾¤ |
| `--project=mai-today-dev` | æŒ‡å®šæ“ä½œå°è±¡ç‚ºå°ˆæ¡ˆ `mai-today-dev` |

---

### ç‚ºä»€éº¼éœ€è¦åŒæ™‚å•Ÿç”¨é€™å…©å€‹æœå‹™ï¼Ÿ
é€™å…©å€‹ API é€šå¸¸éœ€è¦**å”åŒå·¥ä½œ**ä¾†å¯¦ç¾ä»¥ä¸‹æ¶æ§‹ï¼š
1. **GKE é›†ç¾¤ç§æœ‰éƒ¨ç½²**  
   è®“ Kubernetes ç¯€é»é€éç§æœ‰ IP è¨ªå• Google è¨—ç®¡æœå‹™
2. **Cloud SQL/Memorystore ç§æœ‰é€£æ¥**  
   å»ºç«‹å®‰å…¨çš„ç§æœ‰æœå‹™é€£æ¥é€šé“
3. **Serverless VPC è¨ªå•**  
   è®“ Cloud Run/Cloud Functions å®‰å…¨è¨ªå• VPC å…§è³‡æº

---

### Service Networking API å…·é«”ç”¨é€”
```servicenetworking.googleapis.com```
- **ç§æœ‰æœå‹™é€£æ¥**ï¼šå»ºç«‹å°ˆå±¬ VPC å°ç­‰é€£æ¥
- **IP ç¯„åœç®¡ç†**ï¼šç‚ºè¨—ç®¡æœå‹™ä¿ç•™å°ˆç”¨ IP æ®µ
- **DNS è‡ªå‹•é…ç½®**ï¼šç§æœ‰ DNS åŸŸåè§£æ
- **å…¸å‹æ‡‰ç”¨å ´æ™¯**ï¼š
  - GKE é›†ç¾¤ç§æœ‰é€£æ¥åˆ° Cloud SQL
  - Cloud Run è¨ªå• Memorystore Redis
  - æ··åˆé›²ç’°å¢ƒçš„æœå‹™é€£æ¥

---

### Kubernetes Engine API å…·é«”ç”¨é€”
```container.googleapis.com```
- **GKE é›†ç¾¤ç®¡ç†**ï¼šå‰µå»º/æ“´ç¸®/å‡ç´š Kubernetes é›†ç¾¤
- **å·¥ä½œè² è¼‰éƒ¨ç½²**ï¼šéƒ¨ç½²å®¹å™¨åŒ–æ‡‰ç”¨
- **è‡ªå‹•åŒ–é‹ç¶­**ï¼šç¯€é»è‡ªå‹•ä¿®å¾©ã€è‡ªå‹•å‡ç´š
- **é›†æˆæœå‹™**ï¼š
  - Cloud Monitoring/Logging
  - Config Connector (K8s ç®¡ç† GCP è³‡æº)
  - è‡ªå‹•ç¸®æ”¾ (HPA/VPA)

---

### å…¸å‹æ‡‰ç”¨æ¶æ§‹ç¯„ä¾‹
```mermaid
graph LR
    GKE[GKE Cluster] -->|Private IP| CloudSQL
    GKE -->|Private IP| Redis[Memorystore]
    CloudRun -->|Service Networking| GKE
    
    subgraph VPC [Secure VPC Environment]
        GKE
    end
    
    subgraph GoogleManaged [Google è¨—ç®¡æœå‹™]
        CloudSQL[(Cloud SQL)]
        Redis[(Memorystore Redis)]
        CloudRun[Cloud Run]
    end
```

---

### åŸ·è¡Œæ­¤æŒ‡ä»¤çš„å¸¸è¦‹å ´æ™¯
1. **æº–å‚™ GKE éƒ¨ç½²ç’°å¢ƒ**  
   åœ¨å‰µå»ºç§æœ‰ GKE é›†ç¾¤å‰å¿…é ˆå•Ÿç”¨
   
2. **å•Ÿç”¨ Cloud SQL ç§æœ‰é€£æ¥**  
   éœ€ Service Networking å»ºç«‹ peering

3. **Terraform éƒ¨ç½²å‰ç½®ä½œæ¥­**  
   åŸºç¤è¨­æ–½ä»£ç¢¼éœ€å…ˆå•Ÿç”¨ API

4. **CI/CD ç®¡é“åˆå§‹åŒ–**  
   è‡ªå‹•åŒ–éƒ¨ç½²è…³æœ¬çš„ä¸€éƒ¨åˆ†

---

### æˆæœ¬æ³¨æ„äº‹é …
| æœå‹™ | å•Ÿç”¨æˆæœ¬ | å¾ŒçºŒæ½›åœ¨è²»ç”¨ä¾†æº |
|------|----------|------------------|
| Service Networking | **å…è²»** | é—œè¯æœå‹™çš„ç¶²è·¯å‚³è¼¸è²» (å¦‚ Cloud SQL æµé‡) |
| Kubernetes Engine | **å…è²»** | GKE é›†ç¾¤ (ç¯€é»VMã€æŒä¹…ç£ç¢Ÿã€æ§åˆ¶å¹³é¢) |

> ğŸ’¡ é‡è¦æç¤ºï¼šå–®ç´”å•Ÿç”¨ API **ä¸æœƒç”¢ç”Ÿè²»ç”¨**ï¼Œä½†å¾ŒçºŒæ“ä½œéœ€æ³¨æ„ï¼š
> - GKE ç¯€é»çš„æŒçºŒé‹è¡Œæˆæœ¬
> - é€éç§æœ‰é€£æ¥è¨ªå•è¨—ç®¡æœå‹™çš„è²»ç”¨
> - ä¿ç•™ IP åœ°å€çš„è²»ç”¨ï¼ˆå¦‚æœé…ç½®éœæ…‹ IPï¼‰

---

### å¾ŒçºŒå»ºè­°æ“ä½œ
å•Ÿç”¨å¾Œé€šå¸¸éœ€è¦ï¼š
```bash
# é…ç½®ç§æœ‰æœå‹™é€£æ¥
gcloud services vpc-peerings connect \
  --service=servicenetworking.googleapis.com \
  --network=default \
  --project=mai-today-dev

# å‰µå»º GKE ç§æœ‰é›†ç¾¤
gcloud container clusters create private-cluster \
  --enable-private-nodes \
  --master-ipv4-cidr=172.16.0.0/28 \
  --project=mai-today-dev
```

---

### æ¬Šé™éœ€æ±‚
åŸ·è¡Œæ­¤æŒ‡ä»¤éœ€å…·å‚™å°ˆæ¡ˆçš„ï¼š
- `Service Usage Admin` è§’è‰² æˆ–
- `Owner` æ¬Šé™

å»ºè­°ä½¿ç”¨æœ€å°æ¬Šé™åŸå‰‡ï¼š
```bash
gcloud projects add-iam-policy-binding mai-today-dev \
  --member=user:your-account@domain.com \
  --role=roles/serviceusage.serviceUsageAdmin
```

é€™å€‹çµ„åˆæŒ‡ä»¤æ˜¯å»ºæ§‹ç¾ä»£åŒ–å®¹å™¨åŒ–æ¶æ§‹çš„åŸºç¤ï¼Œç‰¹åˆ¥é©ç”¨æ–¼éœ€è¦å®‰å…¨ç§æœ‰é€£æ¥çš„ä¼æ¥­ç´šæ‡‰ç”¨å ´æ™¯ã€‚


GKE (Google Kubernetes Engine) çš„æˆæœ¬è¨ˆè²»éµå¾ª **ã€Œåˆ†å±¤çµæ§‹ã€**ï¼Œä¸»è¦ç”±ä»¥ä¸‹æ ¸å¿ƒå…ƒä»¶çµ„æˆï¼Œä»¥ä¸‹æ˜¯å®Œæ•´è§£æï¼š

---

### ä¸€ã€GKE è¨ˆè²»çµ„æˆç¸½è¦½
| **è¨ˆè²»é …ç›®**         | **è¨ˆè²»æ¨¡å¼**                          | **å‚™è¨»**                                                                 |
|----------------------|---------------------------------------|--------------------------------------------------------------------------|
| **Worker Nodes**     | æŒ‰åº•å±¤ Compute Engine è³‡æºæ”¶è²»         | ä¸»è¦æˆæœ¬ä¾†æº (ä½”æ¯” 70%~90%)                                              |
| **Control Plane**    | Standard æ¨¡å¼å›ºå®šè²» / Autopilot å…è²»   | ç®¡ç†å±¤å·®ç•°                                                                |
| **æŒä¹…åŒ–å„²å­˜**       | æŒ‰é€£çµçš„ PD ç£ç¢Ÿæ”¶è²»                   | SSD/HDD åƒ¹æ ¼ä¸åŒ                                                         |
| **ç¶²è·¯è³‡æº**         | å‡ºå£æµé‡è²» + è² è¼‰å¹³è¡¡å™¨è²»              | è·¨å€åŸŸæµé‡æˆæœ¬é«˜                                                          |
| **å…¶ä»– GCP æœå‹™**    | æŒ‰å¯¦éš›ä½¿ç”¨é‡ (Logging/Monitoring ç­‰)   | å¯é¸ä½†å¸¸è¢«å¿½ç•¥                                                           |

---

### äºŒã€æ ¸å¿ƒå…ƒä»¶è©³è§£
#### 1. Worker Nodes ç¯€é»è¨ˆè²» (æœ€å¤§æˆæœ¬ä¾†æº)
- **æœ¬è³ª**ï¼šæ¯å€‹ Node å°±æ˜¯ä¸€å° Compute Engine VM
- **è¨ˆè²»å› å­**ï¼š
  - **æ©Ÿå™¨é¡å‹**ï¼š`e2-standard-4` æ¯” `n2d-highcpu-32` ä¾¿å®œ
  - **é‹è¡Œæ™‚é–“**ï¼šç§’ç´šè¨ˆè²»ï¼ˆæœ€ä½æŒ‰ 1 åˆ†é˜æ”¶è²»ï¼‰
  - **å€åŸŸå®šåƒ¹**ï¼š`us-central1` æ¯” `asia-northeast1` ä¾¿å®œç´„ 15%
  - **æŠ˜æ‰£é¡å‹**ï¼š
    - æŒçºŒä½¿ç”¨æŠ˜æ‰£ (è‡ªå‹•ç´¯ç©)
    - æ‰¿è«¾ä½¿ç”¨æŠ˜æ‰£ (CUD)ï¼š1/3 å¹´é è³¼æœ€é«˜çœ 70%
    - ç¾æˆ VM (Spot)ï¼šæ¯”å¸¸è¦ä¾¿å®œ 60~91% (**é©åˆç„¡ç‹€æ…‹æœå‹™**)

- **ç¯„ä¾‹æˆæœ¬è¨ˆç®—**ï¼š  
  `n1-standard-4 (4vCPU, 15GB RAM)` åœ¨ `us-central1`  
  = $0.1907/å°æ™‚ Ã— 730 å°æ™‚/æœˆ â‰ˆ **$139.21/æœˆ**

#### 2. Control Plane ç®¡ç†å±¤è¨ˆè²»
| **é›†ç¾¤æ¨¡å¼**   | Control Plane è²»ç”¨                              | é©ç”¨å ´æ™¯                          |
|----------------|------------------------------------------------|----------------------------------|
| **Standard**   | $0.10/é›†ç¾¤/å°æ™‚ (â‰ˆ $73/æœˆ)                      | éœ€ç²¾ç´°æ§åˆ¶ç¯€é»                   |
| **Autopilot**  | **å…è²»**                                       | å…ç®¡ç†ç¯€é»ï¼ŒæŒ‰ Pod è«‹æ±‚è³‡æºæ”¶è²» |

> ğŸ’¡ Autopilot çœå»ç¯€é»ç®¡ç†æˆæœ¬ï¼Œä½† **Pod è³‡æºè²»ç”¨æ¯” Standard é«˜ç´„ 20%**

#### 3. æŒä¹…åŒ–å„²å­˜ (Persistent Volumes)
- å‹•æ…‹ç¶å®š Google Persistent Disk (PD)
- **è¨ˆè²»å› å­**ï¼š
  - **å„²å­˜é¡å‹**ï¼š  
    - SSD PD: $0.170/GB/æœˆ (å¦‚ `pd-ssd`)  
    - HDD PD: $0.040/GB/æœˆ (å¦‚ `pd-standard`)
  - **å¿«ç…§**ï¼š$0.026/GB/æœˆ (æŒ‰å·®ç•°å‚™ä»½è¨ˆ)
  - **IOPS æ“ä½œ**ï¼šç„¡é¡å¤–è²» (å·²åŒ…å«åœ¨é¡å‹å®šåƒ¹)

#### 4. ç¶²è·¯è²»ç”¨ (æ˜“è¶…æ”¯é›·å€)
| é …ç›®                  | è¨ˆè²»èªªæ˜                                                                 |
|-----------------------|--------------------------------------------------------------------------|
| **å‡ºå£æµé‡**          | éšæ¢¯å®šåƒ¹ï¼šé¦– 1TB $0.12/GB â†’ è¶…é 10TB $0.08/GB (è·¨å€åŸŸæ›´è²´)              |
| **è² è¼‰å¹³è¡¡å™¨**        | - æ¯å°æ™‚ $0.025 + æ¯è¦å‰‡ $0.025/å°æ™‚ <br> - è³‡æ–™è™•ç† $0.008/GB           |
| **Service Networking**| ç§æœ‰é€šé“å…è²»ï¼Œä½†ç¶“ç”± NAT çš„å‡ºå£æµé‡æ”¶è²»                                   |

---

### ä¸‰ã€Autopilot vs Standard æˆæœ¬å°æ¯”
å‡è¨­éƒ¨ç½²éœ€æ±‚ï¼š**10 å€‹æŒçºŒé‹è¡Œçš„ Pod (2vCPU+4GB RAM æ¯å€‹)**
#### æ–¹æ¡ˆ 1ï¼šStandard æ¨¡å¼
- ä½¿ç”¨ 3 å° `e2-standard-4` (4vCPU, 16GB)  
  - ç¯€é»æˆæœ¬ï¼š3 Ã— $96.24/æœˆ = **$288.72**  
  - Control Planeï¼š**$73**  
  - **ç¸½è¨ˆ â‰ˆ $361.72**

#### æ–¹æ¡ˆ 2ï¼šAutopilot æ¨¡å¼
- Pod è³‡æºè«‹æ±‚æˆæœ¬ï¼š  
  - vCPUï¼š10 Pod Ã— 2 Ã— $0.03148/å°æ™‚ Ã— 730 â‰ˆ **$459.61**  
  - RAMï¼š10 Pod Ã— 4GB Ã— $0.004236/GB-hr Ã— 730 â‰ˆ **$123.67**  
  - Control Planeï¼š**å…è²»**  
  - **ç¸½è¨ˆ â‰ˆ $583.28**

> âœ… **çµè«–**ï¼šé•·æœŸç©©å®šè² è¼‰é¸ **Standard + CUD æŠ˜æ‰£**ï¼ŒçŸ­æœŸæ³¢å‹•è² è¼‰é¸ **Autopilot**

---

### å››ã€7 å¤§å¯¦ç”¨æˆæœ¬å„ªåŒ–æŠ€å·§
1. **ç²¾æº–è¨­å®šè³‡æºè«‹æ±‚**ï¼ˆé¿å…éåº¦ç”³è«‹ï¼‰  
   ```kubectl top pods``` ç›£æ§å¯¦éš›ç”¨é‡ â†’ èª¿æ•´ `requests/limits`

2. **å•Ÿç”¨å‚ç›´è‡ªå‹•ç¸®æ”¾ (VPA)**  
   ```yaml
   apiVersion: autoscaling.k8s.io/v1
   kind: VerticalPodAutoscaler
   spec:
     targetRef:
       apiVersion: "apps/v1"
       kind: Deployment
       name: my-app
   ```

3. **ä½¿ç”¨ç¯€é»è‡ªå‹•ç¸®æ”¾ (Cluster Autoscaler)**  
   ```bash
   gcloud container clusters update my-cluster \
     --enable-autoscaling \
     --min-nodes=1 --max-nodes=10
   ```

4. **æ··åˆä½¿ç”¨ç¾æˆ VM (Spot VMs)**  
   ```yaml
   spec:
     template:
       spec:
         nodeSelector:
           cloud.google.com/gke-spot: "true"
   ```

5. **æ¡è³¼æ‰¿è«¾ä½¿ç”¨æŠ˜æ‰£ (CUD)**  
   [æ§åˆ¶å°è³¼è²·å…¥å£](https://console.cloud.google.com/compute/commitments)

6. **æ¸…ç†å­¤ç«‹è³‡æº**  
   ```bash
   # æ‰¾å‡ºæœªä½¿ç”¨çš„ PV
   kubectl get pv --field-selector status.phase=Released
   ```

7. **å•Ÿç”¨æˆæœ¬ç›£æ§å„€è¡¨æ¿**  
   ```bash
   # å•Ÿç”¨ GKE æˆæœ¬åˆ†é…åŠŸèƒ½
   gcloud container clusters update my-cluster \
     --cost-management-config=enable-cost-allocation=true
   ```

---

### äº”ã€éš±è—æˆæœ¬é™·é˜±
| **é™·é˜±**                  | **è¦é¿æ–¹æ¡ˆ**                                                                 |
|---------------------------|-----------------------------------------------------------------------------|
| **è·¨å€åŸŸç¶²è·¯æµé‡**        | ä½¿ç”¨åŒå€åŸŸ Cloud Storage/GCR ä½œç‚ºæ˜ åƒå„²å­˜åº«                                  |
| **æœªåˆªé™¤ LoadBalancer**   | éƒ¨ç½² `service` æ™‚è¨»æ˜é¡å‹ï¼š`type: ClusterIP`                                 |
| **PD ç£ç¢Ÿæ®˜ç•™**           | è¨­ç½® `StorageClass` å›æ”¶ç­–ç•¥ï¼š`reclaimPolicy: Delete`                       |
| **é«˜è§£æåº¦ç›£æ§**          | èª¿æ•´ Metrics å–æ¨£é »ç‡ï¼š`--monitoring-resolution=5m` (Standard æ¨¡å¼)         |

---

### å…­ã€æˆæœ¬ç›£æ§æŒ‡ä»¤
```bash
# æŸ¥çœ‹é›†ç¾¤è³‡æºåˆ†é…
kubectl describe nodes | grep -A 10 "Allocated resources"

# å³æ™‚ç›£æ§ç¯€é»åˆ©ç”¨ç‡
gcloud compute instances list --format="table(name,status,machineType,zone)" | grep gke-

# å°å‡ºæœˆè²»ç”¨å ±å‘Š (æ›¿æ› [BILLING_ACCOUNT])
gcloud billing reports describe \
  --billing-account=[BILLING_ACCOUNT] \
  --format="csv(cost, project.name, service.description)" \
  > gke-cost-report.csv
```

æŒæ¡é€™äº›åˆ†é …è¨ˆè²»é‚è¼¯å¾Œï¼Œå¯é‡å°æ‡‰ç”¨å ´æ™¯é¸æ“‡æœ€ä½³éƒ¨ç½²æ¨¡å¼ï¼Œé€šå¸¸ï¼š  
ğŸ”§ **ç²¾ç´°æ§åˆ¶éœ€æ±‚é«˜** â†’ Standard + CUD + Spot  
âš¡ **å¿«é€Ÿéƒ¨ç½²ç„¡ç‹€æ…‹æœå‹™** â†’ Autopilot + ç²¾æº–è³‡æºè«‹æ±‚  
ğŸ’¾ **å¤§æ•¸æ“šæ‰¹è™•ç†** â†’ Standard + Preemptible VMs + è‡ªå‹•ç¸®æ”¾




æ ¹æ“šæä¾›çš„ Terraform é…ç½®ï¼ŒåŸ·è¡Œé€™äº›æ“ä½œéœ€è¦ä»¥ä¸‹ IAM æ¬Šé™ï¼ˆæŒ‰æœå‹™åˆ†é¡ï¼‰ï¼š

---

### **1. Compute Engine æ¬Šé™**
- **ç¶²è·¯èˆ‡ IP ç®¡ç†**ï¼š
  - `compute.networks.create`ï¼ˆå»ºç«‹ VPCï¼‰
  - `compute.networks.get`ï¼ˆè®€å– VPCï¼‰
  - `compute.subnetworks.create`ï¼ˆå»ºç«‹å­ç¶²ï¼‰
  - `compute.globalAddresses.create`ï¼ˆå»ºç«‹å…¨åŸŸå…§éƒ¨ IPï¼‰
- **æœ€å°å»ºè­°è§’è‰²**ï¼š  
  `roles/compute.networkAdmin`ï¼ˆæ¶µè“‹æ‰€æœ‰ç¶²è·¯æ“ä½œï¼‰

---

### **2. Cloud SQL æ¬Šé™**
- **å¯¦ä¾‹èˆ‡è³‡æ–™åº«ç®¡ç†**ï¼š
  - `cloudsql.instances.create`ï¼ˆå»ºç«‹ SQL å¯¦ä¾‹ï¼‰
  - `cloudsql.instances.get`ï¼ˆè®€å–å¯¦ä¾‹ï¼‰
  - `cloudsql.databases.create`ï¼ˆå»ºç«‹è³‡æ–™åº«ï¼‰
  - `cloudsql.users.create`ï¼ˆå»ºç«‹è³‡æ–™åº«ä½¿ç”¨è€…ï¼‰
- **æœ€å°å»ºè­°è§’è‰²**ï¼š  
  `roles/cloudsql.admin`ï¼ˆæ¶µè“‹æ‰€æœ‰ SQL æ“ä½œï¼‰

---

### **3. Service Networking æ¬Šé™**
- **ç§æœ‰æœå‹™é€£æ¥**ï¼š
  - `servicenetworking.services.addPeering`ï¼ˆå»ºç«‹ VPC å°ç­‰é€£æ¥ï¼‰
  - `servicenetworking.connections.get`ï¼ˆè®€å–é€£æ¥ç‹€æ…‹ï¼‰
- **æœ€å°å»ºè­°è§’è‰²**ï¼š  
  `roles/servicenetworking.serviceAgent`ï¼ˆéœ€é¡å¤–ç¶å®šæœå‹™å¸³è™Ÿ `service-<PROJECT_NUMBER>@service-networking.iam.gserviceaccount.com`ï¼‰

---

### **4. Kubernetes Engine (GKE) æ¬Šé™**
- **å¢é›†èˆ‡ç¯€é»æ± ç®¡ç†**ï¼š
  - `container.clusters.create`ï¼ˆå»ºç«‹ GKE å¢é›†ï¼‰
  - `container.clusters.get`ï¼ˆè®€å–å¢é›†ï¼‰
  - `container.nodePools.create`ï¼ˆå»ºç«‹ç¯€é»æ± ï¼‰
  - `container.operations.get`ï¼ˆç›£æ§æ“ä½œç‹€æ…‹ï¼‰
- **æœ€å°å»ºè­°è§’è‰²**ï¼š  
  `roles/container.admin`ï¼ˆæ¶µè“‹æ‰€æœ‰ GKE æ“ä½œï¼‰

---

### **5. IAM æ¬Šé™**
- **æœå‹™å¸³æˆ¶ç®¡ç†**ï¼š
  - `iam.serviceAccounts.create`ï¼ˆå»ºç«‹ GKE ç¯€é» SAï¼‰
  - `iam.serviceAccounts.get`ï¼ˆè®€å– SA è³‡è¨Šï¼‰
- **æœ€å°å»ºè­°è§’è‰²**ï¼š  
  `roles/iam.serviceAccountAdmin`

---

### **6. å°ˆæ¡ˆå±¤ç´šæ¬Šé™ï¼ˆé¸ç”¨ï¼‰**
- **è‹¥éœ€ç¶å®š IAM è§’è‰²ï¼ˆè¨»é‡‹éƒ¨åˆ†ï¼‰**ï¼š
  - `resourcemanager.projects.setIamPolicy`ï¼ˆæˆäºˆ SA `cloudsql.client` è§’è‰²ï¼‰
  - **æœ€å°å»ºè­°è§’è‰²**ï¼š`roles/resourcemanager.projectIamAdmin`

---

### **ç¸½çµæ‰€éœ€ IAM è§’è‰²**
åŸ·è¡Œå®Œæ•´ Terraform é…ç½®çš„æœå‹™å¸³è™Ÿéœ€ç¶å®šä»¥ä¸‹ **é å®šç¾©è§’è‰²**ï¼š

| æœå‹™é¡åˆ¥          | æœ€å° IAM è§’è‰²                          |
|-------------------|----------------------------------------|
| Compute Engine    | `roles/compute.networkAdmin`           |
| Cloud SQL         | `roles/cloudsql.admin`                 |
| Service Networking| `roles/servicenetworking.serviceAgent` |
| GKE               | `roles/container.admin`                |
| IAM               | `roles/iam.serviceAccountAdmin`        |
| **é¸ç”¨** (IAM ç¶å®š) | `roles/resourcemanager.projectIamAdmin` |

---

### **è£œå……èªªæ˜**
1. **Service Networking ç‰¹æ®Šè¦æ±‚**ï¼š  
   éœ€å°‡ `roles/servicenetworking.serviceAgent` è§’è‰²æˆäºˆ **Google ç®¡ç†çš„æœå‹™å¸³è™Ÿ**ï¼š  
   `service-<PROJECT_NUMBER>@service-networking.iam.gserviceaccount.com`
   
2. **æœ€å°æ¬Šé™å¯¦è¸**ï¼š  
   è‹¥éœ€åš´æ ¼é™åˆ¶æ¬Šé™ï¼Œå¯åŸºæ–¼ä¸Šè¿°æ¬Šé™å»ºç«‹è‡ªè¨‚è§’è‰²ï¼Œä½†é å®šç¾©è§’è‰²å·²æ¶µè“‹å¤§éƒ¨åˆ†æ“ä½œã€‚

3. **ä¾è³´æœå‹™å•Ÿç”¨**ï¼š  
   ç¢ºä¿å°ˆæ¡ˆå•Ÿç”¨ä»¥ä¸‹ APIï¼š  
   - `compute.googleapis.com`
   - `sqladmin.googleapis.com`
   - `servicenetworking.googleapis.com`
   - `container.googleapis.com`
   - `iam.googleapis.com`

> ğŸ’¡ **æç¤º**ï¼šéƒ¨ç½²å‰è«‹ç¢ºèªæœå‹™å¸³è™Ÿç¶å®šæ‰€æœ‰å¿…è¦è§’è‰²ï¼Œä¸¦æª¢æŸ¥ API å·²å•Ÿç”¨ã€‚

è¦ä½¿ç”¨ `gcloud` CLI åˆ—å‡ºæ‰€æœ‰ IAM æ¬Šé™å’Œè§’è‰²ï¼Œä»¥ä¸‹æ˜¯è©³ç´°æ­¥é©Ÿï¼š

---

### **1. åˆ—å‡ºç•¶å‰å¸³æˆ¶çš„æ‰€æœ‰ç›´æ¥æˆäºˆè§’è‰²**
```bash
# ç²å–ç•¶å‰é …ç›® ID
PROJECT_ID=$(gcloud config get-value project)

# åˆ—å‡ºç•¶å‰å¸³æˆ¶åœ¨é …ç›®ä¸­è¢«ç›´æ¥æˆäºˆçš„è§’è‰²
gcloud projects get-iam-policy $PROJECT_ID \
  --flatten="bindings[].members" \
  --format="table(bindings.role)" \
  --filter="bindings.members:$(gcloud config get-value account)"
```

---

### **2. åˆ—å‡ºæœå‹™å¸³æˆ¶çš„æ‰€æœ‰è§’è‰²**
```bash
# æ›¿æ›ç‚ºç›®æ¨™æœå‹™å¸³æˆ¶éƒµç®±
SA_EMAIL="your-service-account@project-id.iam.gserviceaccount.com"

gcloud projects get-iam-policy $PROJECT_ID \
  --flatten="bindings[].members" \
  --format="table(bindings.role)" \
  --filter="bindings.members:serviceAccount:$SA_EMAIL"
```

---

### **3. åˆ—å‡ºæ‰€æœ‰é å®šç¾©è§’è‰²åŠå…¶æ¬Šé™**
```bash
# åˆ—å‡ºæ‰€æœ‰å¯ç”¨è§’è‰²ï¼ˆå«è‡ªå®šç¾©è§’è‰²ï¼‰
gcloud iam roles list --project=$PROJECT_ID

# æŸ¥çœ‹ç‰¹å®šè§’è‰²çš„è©³ç´°æ¬Šé™ï¼ˆä¾‹å¦‚ roles/container.adminï¼‰
gcloud iam roles describe roles/container.admin
```

---

### **4. åˆ—å‡ºé …ç›®ä¸­æ‰€æœ‰ç¶å®šçš„ IAM è§’è‰²**
```bash
# å®Œæ•´è¼¸å‡ºé …ç›®ä¸­æ‰€æœ‰ IAM ç¶å®šé—œä¿‚
gcloud projects get-iam-policy $PROJECT_ID \
  --format=json | jq -r '.bindings[] | "\(.role): \(.members[])"'
```

---

### **5. é«˜ç´šï¼šä½¿ç”¨ Asset Inventory åˆ†ææ¬Šé™**
**éœ€å•Ÿç”¨ Cloud Asset API**ï¼š
```bash
gcloud services enable cloudasset.googleapis.com
```

**åˆ—å‡ºæŒ‡å®šå¸³æˆ¶çš„æ‰€æœ‰æ¬Šé™ï¼ˆåŒ…æ‹¬ç¹¼æ‰¿ï¼‰**ï¼š
```bash
# åˆ†æç•¶å‰å¸³æˆ¶çš„å¯¦éš›æ¬Šé™ï¼ˆéœ€è¦ roles/cloudasset.viewer æ¬Šé™ï¼‰
gcloud asset analyze-iam-policy \
  --project=$PROJECT_ID \
  --identity="user:$(gcloud config get-value account)" \
  --permissions \
  --format="table(permissions)"
```

**è¼¸å‡ºç¯„ä¾‹**ï¼š
```
PERMISSIONS
compute.networks.create
compute.subnetworks.create
container.clusters.create
...
```

---

### **6. æª¢æŸ¥ç‰¹å®šæ¬Šé™æ˜¯å¦å­˜åœ¨**
```bash
# æª¢æŸ¥æ˜¯å¦æ“æœ‰ç‰¹å®šæ¬Šé™ï¼ˆä¾‹å¦‚ container.clusters.createï¼‰
gcloud asset analyze-iam-policy \
  --project=$PROJECT_ID \
  --identity="user:$(gcloud config get-value account)" \
  --permissions='container.clusters.create' \
  --format="value(permissions)"
```

---

### **é—œéµèªªæ˜**
1. **æ¬Šé™ (Permissions) vs è§’è‰² (Roles)**ï¼š
   - **è§’è‰²** = æ¬Šé™çš„é›†åˆï¼ˆä¾‹å¦‚ `roles/container.admin` åŒ…å« 40+ å€‹æ¬Šé™ï¼‰
   - **æ¬Šé™** = å…·é«”æ“ä½œï¼ˆä¾‹å¦‚ `container.clusters.create`ï¼‰

2. **ç¹¼æ‰¿é—œä¿‚**ï¼š
   - æ¬Šé™å¯èƒ½ä¾†è‡ªï¼š
     - é …ç›®å±¤ç´šçš„ç›´æ¥æˆäºˆ
     - è³‡æ–™å¤¾/çµ„ç¹”å±¤ç´šçš„ç¹¼æ‰¿
     - ç¾¤çµ„æˆå“¡è³‡æ ¼ï¼ˆéœ€ä½¿ç”¨ `--identity` åƒæ•¸æ·±åº¦åˆ†æï¼‰

3. **å¿…è¦æ¬Šé™**ï¼š
   - åŸ·è¡Œé€™äº›å‘½ä»¤éœ€è¦ï¼š
     - `roles/viewer`ï¼ˆåŸºæœ¬è®€å–ï¼‰
     - `roles/cloudasset.viewer`ï¼ˆç”¨æ–¼æ¬Šé™åˆ†æï¼‰

4. **è‡ªå®šç¾©è§’è‰²**ï¼š
   - ä½¿ç”¨ `gcloud iam roles list --project=$PROJECT_ID` æŸ¥çœ‹å°ˆæ¡ˆè‡ªå®šç¾©è§’è‰²
   - ä½¿ç”¨ `gcloud iam roles describe ROLE_ID --project=$PROJECT_ID` æŸ¥çœ‹è©³ç´°æ¬Šé™

> ğŸ’¡ **æç¤º**ï¼šå°æ–¼å®Œæ•´æ¬Šé™åˆ†æï¼Œæ¨è–¦ä½¿ç”¨ `gcloud asset analyze-iam-policy`ï¼Œå®ƒèƒ½æ¶µè“‹æ‰€æœ‰ç¹¼æ‰¿ä¾†æºçš„æ¬Šé™ã€‚
