å¥½çš„ï¼Œæˆ‘å€‘ä¾†è©³ç´°è¬›è§£ `gcloud services enable compute.googleapis.com` é€™å€‹æŒ‡ä»¤ï¼š

### æŒ‡ä»¤ä½œç”¨
é€™å€‹æŒ‡ä»¤ç”¨æ–¼åœ¨ **Google Cloud Platform (GCP)** çš„ç•¶å‰å°ˆæ¡ˆä¸­ **å•Ÿç”¨ Compute Engine API æœå‹™**ã€‚ç°¡å–®ä¾†èªªï¼Œå®ƒæ˜¯ä½¿ç”¨ GCP è™›æ“¬æ©Ÿå™¨ï¼ˆVMï¼‰æœå‹™çš„å¿…è¦æº–å‚™æ­¥é©Ÿã€‚

---

### æŒ‡ä»¤æ‹†è§£
| éƒ¨åˆ† | èªªæ˜ |
|------|------|
| `gcloud` | Google Cloud SDK çš„å‘½ä»¤åˆ—å·¥å…· |
| `services` | ç®¡ç† GCP API æœå‹™çš„å­å‘½ä»¤ç¾¤çµ„ |
| `enable` | å•Ÿç”¨æŒ‡å®šæœå‹™çš„æ“ä½œ |
| `compute.googleapis.com` | **Compute Engine API çš„æ­£å¼æœå‹™åç¨±** |

---

### ç‚ºä»€éº¼éœ€è¦é€™å€‹æŒ‡ä»¤ï¼Ÿ
1. **æ¬Šé™æ§åˆ¶**ï¼šGCP é è¨­æ‰€æœ‰ API éƒ½æ˜¯é—œé–‰ç‹€æ…‹ï¼Œéœ€æ‰‹å‹•å•Ÿç”¨ï¼ˆå®‰å…¨èˆ‡æˆæœ¬è€ƒé‡ï¼‰ã€‚
2. **ä½¿ç”¨ Compute Engine çš„å‰æ**ï¼š
   - å»ºç«‹/ç®¡ç†è™›æ“¬æ©Ÿå™¨ï¼ˆVMï¼‰
   - ä½¿ç”¨è² è¼‰å¹³è¡¡å™¨ã€ç£ç¢Ÿã€å¿«ç…§ç­‰åŠŸèƒ½
   - æ“ä½œå¯¦ä¾‹ç¾¤çµ„ï¼ˆInstance Groupsï¼‰
3. **è¨ˆè²»è§¸ç™¼é»**ï¼šå•Ÿç”¨æœå‹™å¾Œï¼Œå¯¦éš›ä½¿ç”¨è³‡æºæ‰æœƒé–‹å§‹è¨ˆè²»ï¼ˆå•Ÿç”¨æœ¬èº«å…è²»ï¼‰ã€‚

---

### åŸ·è¡Œæ­¥é©Ÿ
1. **å®‰è£ Google Cloud SDK**  
   [å®˜æ–¹å®‰è£æŒ‡å¼•](https://cloud.google.com/sdk/docs/install)

2. **ç™»å…¥ä¸¦è¨­å®šå°ˆæ¡ˆ**ï¼ˆçµ‚ç«¯æ©ŸåŸ·è¡Œï¼‰
   ```bash
   gcloud auth login        # ç™»å…¥æ‚¨çš„ Google å¸³è™Ÿ
   gcloud config set project YOUR_PROJECT_ID  # æ›¿æ›ç‚ºæ‚¨çš„å°ˆæ¡ˆID
   ```

3. **åŸ·è¡Œå•Ÿç”¨æŒ‡ä»¤**
   ```bash
   gcloud services enable compute.googleapis.com
   ```

4. **é©—è­‰æ˜¯å¦å•Ÿç”¨æˆåŠŸ**
   ```bash
   gcloud services list --enabled | grep compute.googleapis.com
   ```
   è‹¥çœ‹åˆ°è¼¸å‡ºè¡¨ç¤ºå·²å•Ÿç”¨ã€‚

---

### å¸¸è¦‹æƒ…å¢ƒç¯„ä¾‹
#### æƒ…å¢ƒ 1ï¼šé¦–æ¬¡å»ºç«‹ VM å‰
```bash
# å•Ÿç”¨ Compute Engine API
gcloud services enable compute.googleapis.com

# å»ºç«‹ VM å¯¦ä¾‹
gcloud compute instances create my-vm --zone=us-central1-a
```

#### æƒ…å¢ƒ 2ï¼šè‡ªå‹•åŒ–è…³æœ¬ä¸­ç¢ºä¿æœå‹™å•Ÿç”¨
```bash
#!/bin/bash
# æª¢æŸ¥æœå‹™æ˜¯å¦å•Ÿç”¨ï¼Œè‹¥æœªå•Ÿç”¨å‰‡å•Ÿç”¨ä¹‹
if ! gcloud services list --enabled | grep -q compute.googleapis.com; then
  echo "å•Ÿç”¨ Compute Engine API..."
  gcloud services enable compute.googleapis.com
fi
```

---

### æ³¨æ„äº‹é …
1. **æ¬Šé™éœ€æ±‚**ï¼š  
   éœ€è¦å°ˆæ¡ˆçš„ `Service Usage Admin` æˆ– `Project Owner` è§’è‰²ã€‚
   
2. **å•Ÿç”¨æ™‚é–“**ï¼š  
   é€šå¸¸å¹¾ç§’å…§å®Œæˆï¼Œä½†é¦–æ¬¡å•Ÿç”¨å¯èƒ½éœ€ 1~2 åˆ†é˜ã€‚

3. **ç›¸é—œæœå‹™**ï¼š  
   è‹¥éœ€å®Œæ•´ä½¿ç”¨ Compute Engineï¼Œå»ºè­°ä¸€ä½µå•Ÿç”¨ï¼š
   ```bash
   gcloud services enable \
     compute.googleapis.com \
     cloudresourcemanager.googleapis.com \
     iam.googleapis.com
   ```

4. **æª¢è¦–æ‰€æœ‰å¯å•Ÿç”¨æœå‹™**ï¼š
   ```bash
   gcloud services list --available
   ```

---

### æ›¿ä»£åšæ³•
- **GCP æ§åˆ¶å°å•Ÿç”¨**ï¼š  
  å°è¦½è‡³ï¼š`API èˆ‡æœå‹™ > è³‡æ–™åº«` > æœå°‹ "Compute Engine API" > é»æ“Š `å•Ÿç”¨`

---

### é‡è¦æç¤º
âœ… **å°ˆæ¡ˆå±¤ç´šç”Ÿæ•ˆ**ï¼šå•Ÿç”¨å¾Œå°è©²å°ˆæ¡ˆå…§æ‰€æœ‰ä½¿ç”¨è€…é–‹æ”¾  
âš ï¸ **ä¸å¯é€†æ“ä½œ**ï¼šç„¡æ³•ã€Œåœç”¨ã€åªèƒ½ã€Œé—œé–‰è¨ˆè²»ã€ï¼ˆéœ€é€éæ”¯æ´ç”³è«‹ï¼‰  
ğŸ’¡ å•Ÿç”¨å¾Œä»é ˆ IAM æ¬Šé™æ‰èƒ½æ“ä½œè³‡æº

æŒæ¡é€™å€‹æŒ‡ä»¤å¾Œï¼Œæ‚¨å°±èƒ½é–‹å§‹åœ¨ GCP ä¸Šè‡ªç”±å‰µå»ºå’Œç®¡ç†è™›æ“¬æ©Ÿå™¨äº†ï¼

é—œæ–¼å•Ÿç”¨ `compute.googleapis.com`ï¼ˆCompute Engine APIï¼‰çš„æˆæœ¬ç–‘æ…®ï¼Œä»¥ä¸‹æ˜¯é—œéµåˆ†æèˆ‡å¯¦éš›å»ºè­°ï¼š

---

### âš ï¸ æ ¸å¿ƒåŸå‰‡ï¼š**ã€Œå•Ÿç”¨ API æœå‹™æœ¬èº«å®Œå…¨å…è²»ã€**
- **ä¸ç”¢ç”Ÿç›´æ¥è²»ç”¨**ï¼šå–®ç´”åŸ·è¡Œ `gcloud services enable compute.googleapis.com` **ä¸æœƒç”¢ç”Ÿä»»ä½•è²»ç”¨**ã€‚
- **å¾ŒçºŒæ“ä½œæ‰æœƒè¨ˆè²»**ï¼šåªæœ‰ç•¶æ‚¨**å¯¦éš›ä½¿ç”¨ Compute Engine è³‡æº**ï¼ˆå¦‚å»ºç«‹ VMã€ç£ç¢Ÿã€è² è¼‰å¹³è¡¡å™¨ç­‰ï¼‰æ™‚ï¼Œæ‰æŒ‰ç”¨é‡æ”¶è²»ã€‚

---

### ğŸ” æˆæœ¬é¢¨éšªä¾†æºï¼ˆéæŒ‡ä»¤æœ¬èº«ï¼Œè€Œæ˜¯å¾ŒçºŒæ“ä½œï¼‰
| **é¢¨éšªé¡å‹**       | **èªªæ˜**                                                                 | **é˜²ç¯„æªæ–½**                                                                 |
|--------------------|-------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| **æ„å¤–å•Ÿç”¨ä»˜è²»è³‡æº** | èª¤æ“ä½œå»ºç«‹ VM å¯¦ä¾‹ï¼ˆå°¤å…¶é«˜è¦æ ¼æ©Ÿå‹ï¼‰æˆ–é•·æœŸé‹è¡Œ                           | âœ”ï¸ è¨­å®š[é ç®—è­¦å ±](https://cloud.google.com/billing/docs/how-to/budgets) <br> âœ”ï¸ ä½¿ç”¨ `--preemptible` å»ºç«‹[å¯ä¸­æ–·VM](https://cloud.google.com/compute/docs/instances/preemptible) çœè²» |
| **é–’ç½®è³‡æºç´¯ç©è²»ç”¨** | å¿˜è¨˜é—œåœæ¸¬è©¦ç”¨çš„ VMã€ç£ç¢Ÿæˆ–ä¿ç•™ IP åœ°å€                                 | âœ”ï¸ å®šæœŸç”¨æŒ‡ä»¤æª¢æŸ¥é–’ç½®è³‡æºï¼š<br> `gcloud compute instances list` <br> `gcloud compute disks list` |
| **å¤–éƒ¨ IP åœ°å€è²»ç”¨** | å³ä½¿ VM é—œæ©Ÿï¼Œ**æœªè¢«ä½¿ç”¨çš„éœæ…‹å¤–éƒ¨ IP ä»æŒ‰[æ¯å°æ™‚è¨ˆè²»](https://cloud.google.com/vpc/network-pricing#ipaddress)** | âœ”ï¸ åˆªé™¤ä¸éœ€è¦çš„ IPï¼š<br> `gcloud compute addresses delete [IP_NAME]` |
| **æœ€ä½è¨ˆè²»å–®ä½**     | éƒ¨åˆ†è³‡æºæŒ‰ç§’è¨ˆè²»ä½†æœ‰æœ€ä½é–€æª»ï¼ˆä¾‹å¦‚ï¼šVM å¯¦ä¾‹æœ€ä½æŒ‰ 1 åˆ†é˜æ”¶è²»ï¼‰           | âœ”ï¸ çŸ­æœŸæ¸¬è©¦å¾Œç«‹å³åˆªé™¤è³‡æº                                                                 |

---

### ğŸ’¡ å¯¦å‹™å»ºè­°ï¼šå®‰å…¨å•Ÿç”¨ API ä¸”é¿å…æ„å¤–æˆæœ¬
1. **å…è²»é¡åº¦åˆ©ç”¨**ï¼ˆé¦–å¹´æ–°ç”¨æˆ¶ï¼‰ï¼š
   - GCP æä¾› [Always Free é¡åº¦](https://cloud.google.com/free/docs/gcp-free-tier)ï¼ŒåŒ…å«ï¼š
     - æ¯æœˆ 1 å° f1-micro VM (ç‰¹å®šå€åŸŸ)
     - 30GB æ¨™æº–ç£ç¢Ÿ
     - 5GB å¿«ç…§å„²å­˜
     - 1GB å¤–éƒ¨IPæµé‡

2. **å¼·åˆ¶å•Ÿç”¨é ç®—è­¦å ±**ï¼š
   ```bash
   # å»ºç«‹æ¯æœˆ $10 é ç®—è­¦å ±ï¼ˆæ›¿æ› [BILLING_ACCOUNT_ID]ï¼‰
   gcloud billing budgets create \
     --billing-account=[BILLING_ACCOUNT_ID] \
     --display-name="é˜²è¶…æ”¯ç›£æ§" \
     --budget-amount=10 \
     --threshold-rule=percent=0.5 \
     --threshold-rule=percent=0.9 \
     --filter-projects="[YOUR_PROJECT_ID]"
   ```

3. **æ¸¬è©¦å®Œç«‹å³æ¸…ç†**ï¼š
   ```bash
   # åˆªé™¤æ¸¬è©¦ç”¨ VM é€£åŒç£ç¢Ÿï¼ˆç¯„ä¾‹ï¼‰
   gcloud compute instances delete my-test-vm --zone=us-central1-a --delete-disks=all
   ```

4. **æ¬Šé™æœ€å°åŒ–åŸå‰‡**ï¼š
   - é¿å…ç›´æ¥è³¦äºˆé–‹ç™¼è€… `Project Owner` æ¬Šé™
   - æ”¹ç”¨ç²¾ç´°æ¬Šé™è§’è‰²ï¼ˆå¦‚ `Compute Instance Admin (v1)`ï¼‰

---

### âœ… å®‰å…¨å•Ÿç”¨æ“ä½œæµç¨‹ï¼ˆé›¶æˆæœ¬å‰æï¼‰
```bash
# 1. ç™»å…¥ & è¨­å®šå°ˆæ¡ˆ
gcloud auth login
gcloud config set project YOUR_SAFE_PROJECT_ID

# 2. å•Ÿç”¨ APIï¼ˆä»å…è²»ï¼‰
gcloud services enable compute.googleapis.com

# 3. ä½¿ç”¨å…è²»è³‡æºï¼ˆä¾‹å¦‚åœ¨ us-west1 å€åŸŸå»ºç«‹ f1-microï¼‰
gcloud compute instances create free-tier-vm \
  --machine-type=f1-micro \
  --zone=us-west1-a \
  --image-project=debian-cloud \
  --image-family=debian-12
```

---

### âš ï¸ é‡è¦æ³¨æ„
- **åˆªé™¤å°ˆæ¡ˆ = åœæ­¢æ‰€æœ‰è¨ˆè²»**ï¼šç•¶æ‚¨åˆªé™¤æ•´å€‹ GCP å°ˆæ¡ˆæ™‚ï¼Œ**æ‰€æœ‰é—œè¯è³‡æºæœƒç«‹å³åœæ­¢è¨ˆè²»**ï¼ˆæœ€å¾¹åº•çš„é˜²å‘†æ³•ï¼‰ã€‚
- **ç›£æ§å…¥å£**ï¼šéš¨æ™‚åœ¨ [GCP æˆæœ¬ç®¡ç†ä»‹é¢](https://console.cloud.google.com/billing/) æŸ¥çœ‹å³æ™‚èŠ±è²»ã€‚

> ğŸ’¡ **çµè«–ï¼šå–®ç´”å•Ÿç”¨ API ç„¡éœ€æ“”å¿ƒè²»ç”¨ï¼Œä½†å¾ŒçºŒæ“ä½œéœ€æ­é…æˆæœ¬ç®¡æ§æªæ–½ã€‚** æŒæ¡ã€Œç”¨å®Œå³åˆªã€åŸå‰‡ä¸¦è¨­å®šé ç®—è­¦å ±ï¼Œå³å¯å®‰å…¨æ¢ç´¢ Compute Engine åŠŸèƒ½ã€‚



é€™å€‹æŒ‡ä»¤ç”¨é€”æ˜¯ç‚ºæŒ‡å®š GCP å°ˆæ¡ˆ**åŒæ™‚å•Ÿç”¨å…©å€‹é—œéµæœå‹™**ï¼Œä»¥ä¸‹æ˜¯è©³ç´°è§£æï¼š

```bash
gcloud services enable servicenetworking.googleapis.com \
  container.googleapis.com --project=mai-today-dev
```

### æ ¸å¿ƒåŠŸèƒ½æ‹†è§£
| çµ„ä»¶ | èªªæ˜ |
|------|------|
| `servicenetworking.googleapis.com` | **Service Networking API** - ç®¡ç† VPC ç¶²çµ¡æœå‹™é€£æ¥ |
| `container.googleapis.com` | **Kubernetes Engine API (GKE)** - ç®¡ç† GKE å®¹å™¨é›†ç¾¤ |
| `--project=mai-today-dev` | æŒ‡å®šæ“ä½œå°è±¡ç‚ºå°ˆæ¡ˆ `mai-today-dev` |

---

### ç‚ºä»€éº¼éœ€è¦åŒæ™‚å•Ÿç”¨é€™å…©å€‹æœå‹™ï¼Ÿ
é€™å…©å€‹ API é€šå¸¸éœ€è¦**å”åŒå·¥ä½œ**ä¾†å¯¦ç¾ä»¥ä¸‹æ¶æ§‹ï¼š
1. **GKE é›†ç¾¤ç§æœ‰éƒ¨ç½²**  
   è®“ Kubernetes ç¯€é»é€éç§æœ‰ IP è¨ªå• Google è¨—ç®¡æœå‹™
2. **Cloud SQL/Memorystore ç§æœ‰é€£æ¥**  
   å»ºç«‹å®‰å…¨çš„ç§æœ‰æœå‹™é€£æ¥é€šé“
3. **Serverless VPC è¨ªå•**  
   è®“ Cloud Run/Cloud Functions å®‰å…¨è¨ªå• VPC å…§è³‡æº

---

### Service Networking API å…·é«”ç”¨é€”
```servicenetworking.googleapis.com```
- **ç§æœ‰æœå‹™é€£æ¥**ï¼šå»ºç«‹å°ˆå±¬ VPC å°ç­‰é€£æ¥
- **IP ç¯„åœç®¡ç†**ï¼šç‚ºè¨—ç®¡æœå‹™ä¿ç•™å°ˆç”¨ IP æ®µ
- **DNS è‡ªå‹•é…ç½®**ï¼šç§æœ‰ DNS åŸŸåè§£æ
- **å…¸å‹æ‡‰ç”¨å ´æ™¯**ï¼š
  - GKE é›†ç¾¤ç§æœ‰é€£æ¥åˆ° Cloud SQL
  - Cloud Run è¨ªå• Memorystore Redis
  - æ··åˆé›²ç’°å¢ƒçš„æœå‹™é€£æ¥

---

### Kubernetes Engine API å…·é«”ç”¨é€”
```container.googleapis.com```
- **GKE é›†ç¾¤ç®¡ç†**ï¼šå‰µå»º/æ“´ç¸®/å‡ç´š Kubernetes é›†ç¾¤
- **å·¥ä½œè² è¼‰éƒ¨ç½²**ï¼šéƒ¨ç½²å®¹å™¨åŒ–æ‡‰ç”¨
- **è‡ªå‹•åŒ–é‹ç¶­**ï¼šç¯€é»è‡ªå‹•ä¿®å¾©ã€è‡ªå‹•å‡ç´š
- **é›†æˆæœå‹™**ï¼š
  - Cloud Monitoring/Logging
  - Config Connector (K8s ç®¡ç† GCP è³‡æº)
  - è‡ªå‹•ç¸®æ”¾ (HPA/VPA)

---

### å…¸å‹æ‡‰ç”¨æ¶æ§‹ç¯„ä¾‹
```mermaid
graph LR
    GKE[GKE Cluster] -->|Private IP| CloudSQL
    GKE -->|Private IP| Redis[Memorystore]
    CloudRun -->|Service Networking| GKE
    
    subgraph VPC [Secure VPC Environment]
        GKE
    end
    
    subgraph GoogleManaged [Google è¨—ç®¡æœå‹™]
        CloudSQL[(Cloud SQL)]
        Redis[(Memorystore Redis)]
        CloudRun[Cloud Run]
    end
```

---

### åŸ·è¡Œæ­¤æŒ‡ä»¤çš„å¸¸è¦‹å ´æ™¯
1. **æº–å‚™ GKE éƒ¨ç½²ç’°å¢ƒ**  
   åœ¨å‰µå»ºç§æœ‰ GKE é›†ç¾¤å‰å¿…é ˆå•Ÿç”¨
   
2. **å•Ÿç”¨ Cloud SQL ç§æœ‰é€£æ¥**  
   éœ€ Service Networking å»ºç«‹ peering

3. **Terraform éƒ¨ç½²å‰ç½®ä½œæ¥­**  
   åŸºç¤è¨­æ–½ä»£ç¢¼éœ€å…ˆå•Ÿç”¨ API

4. **CI/CD ç®¡é“åˆå§‹åŒ–**  
   è‡ªå‹•åŒ–éƒ¨ç½²è…³æœ¬çš„ä¸€éƒ¨åˆ†

---

### æˆæœ¬æ³¨æ„äº‹é …
| æœå‹™ | å•Ÿç”¨æˆæœ¬ | å¾ŒçºŒæ½›åœ¨è²»ç”¨ä¾†æº |
|------|----------|------------------|
| Service Networking | **å…è²»** | é—œè¯æœå‹™çš„ç¶²è·¯å‚³è¼¸è²» (å¦‚ Cloud SQL æµé‡) |
| Kubernetes Engine | **å…è²»** | GKE é›†ç¾¤ (ç¯€é»VMã€æŒä¹…ç£ç¢Ÿã€æ§åˆ¶å¹³é¢) |

> ğŸ’¡ é‡è¦æç¤ºï¼šå–®ç´”å•Ÿç”¨ API **ä¸æœƒç”¢ç”Ÿè²»ç”¨**ï¼Œä½†å¾ŒçºŒæ“ä½œéœ€æ³¨æ„ï¼š
> - GKE ç¯€é»çš„æŒçºŒé‹è¡Œæˆæœ¬
> - é€éç§æœ‰é€£æ¥è¨ªå•è¨—ç®¡æœå‹™çš„è²»ç”¨
> - ä¿ç•™ IP åœ°å€çš„è²»ç”¨ï¼ˆå¦‚æœé…ç½®éœæ…‹ IPï¼‰

---

### å¾ŒçºŒå»ºè­°æ“ä½œ
å•Ÿç”¨å¾Œé€šå¸¸éœ€è¦ï¼š
```bash
# é…ç½®ç§æœ‰æœå‹™é€£æ¥
gcloud services vpc-peerings connect \
  --service=servicenetworking.googleapis.com \
  --network=default \
  --project=mai-today-dev

# å‰µå»º GKE ç§æœ‰é›†ç¾¤
gcloud container clusters create private-cluster \
  --enable-private-nodes \
  --master-ipv4-cidr=172.16.0.0/28 \
  --project=mai-today-dev
```

---

### æ¬Šé™éœ€æ±‚
åŸ·è¡Œæ­¤æŒ‡ä»¤éœ€å…·å‚™å°ˆæ¡ˆçš„ï¼š
- `Service Usage Admin` è§’è‰² æˆ–
- `Owner` æ¬Šé™

å»ºè­°ä½¿ç”¨æœ€å°æ¬Šé™åŸå‰‡ï¼š
```bash
gcloud projects add-iam-policy-binding mai-today-dev \
  --member=user:your-account@domain.com \
  --role=roles/serviceusage.serviceUsageAdmin
```

é€™å€‹çµ„åˆæŒ‡ä»¤æ˜¯å»ºæ§‹ç¾ä»£åŒ–å®¹å™¨åŒ–æ¶æ§‹çš„åŸºç¤ï¼Œç‰¹åˆ¥é©ç”¨æ–¼éœ€è¦å®‰å…¨ç§æœ‰é€£æ¥çš„ä¼æ¥­ç´šæ‡‰ç”¨å ´æ™¯ã€‚
