é€™æ˜¯ä¸€ä»½ç›¸ç•¶å®Œæ•´ä¸”ç¾ä»£åŒ–çš„ä¼æ¥­ç´šç³»çµ±æ¶æ§‹è¨­è¨ˆï¼ˆçœ‹ä¼¼ Master Data Management - MDM ç‰©æ–™ä¸»æ•¸æ“šç®¡ç†ç³»çµ±ï¼‰ã€‚ä½ å¼•å…¥äº† K8s (KEDA)ã€å‘é‡æª¢ç´¢ (Vector Search)ã€LLM Agent ä»¥åŠåˆ†æ•£å¼æ¶æ§‹çš„è€ƒé‡ï¼Œé¡¯ç¤ºå‡ºä½ å°ç•¶å‰æŠ€è¡“è¶¨å‹¢æœ‰å¾ˆå¥½çš„æŒæ¡ã€‚

ç„¶è€Œï¼Œæ¶æ§‹è¨­è¨ˆçš„ç²¾é«“åœ¨æ–¼**æ¬Šè¡¡ (Trade-off)**ã€‚é‡å°ä½ çš„è¨­è¨ˆæ€è·¯èˆ‡æå‡ºçš„ 12 é»ï¼Œæˆ‘å°‡åˆ†ç‚º **ã€Œæ ¸å¿ƒäº®é»ã€**ã€**ã€Œé—œéµé¢¨éšªèˆ‡æ‰¹åˆ¤ã€** ä»¥åŠ **ã€Œå„ªåŒ–å»ºè­°ã€** ä¸‰å€‹éƒ¨åˆ†é€²è¡Œæ·±åº¦é»è©•ã€‚

---

### 1. æ ¸å¿ƒäº®é» (Strengths)

* **ç¾ä»£åŒ– AI æ•´åˆ (Points 6, 7):**
    å¼•å…¥ `MCP (Model Context Protocol)` server å’Œ Embedding æ˜¯ä¸€å€‹éå¸¸å‰ç»çš„è¨­è¨ˆã€‚é€™è®“ç³»çµ±ä¸åƒ…æ˜¯ "CRUD" å·¥å…·ï¼Œè€Œæ˜¯å…·å‚™èªæ„ç†è§£èƒ½åŠ›çš„æ™ºæ…§ç³»çµ±ã€‚ä½¿ç”¨å‘é‡æª¢ç´¢ (Elasticsearch) è§£æ±ºäº†å‚³çµ±é—œéµå­—æœå°‹ç„¡æ³•è™•ç† "ç›¸ä¼¼ç‰©æ–™" æˆ– "æ¨¡ç³Šæè¿°" çš„ç—›é»ã€‚
* **å½ˆæ€§èˆ‡è‡ªå‹•åŒ– (Points 12, 5):**
    åˆ©ç”¨ `KEDA` ç›£æ§ Queue depth ä¾†é©…å‹• Consumer Pod çš„è‡ªå‹•æ“´å±•ï¼Œé€™æ˜¯è™•ç†çªç™¼æµé‡ï¼ˆå¦‚æ‰¹é‡åŒ¯å…¥æˆ–å¤§é‡ä¸‹æ¸¸åŒæ­¥ï¼‰çš„æœ€ä½³å¯¦è¸ã€‚åŠ ä¸Š Priority Queue çš„è¨­è¨ˆï¼Œèƒ½ç¢ºä¿æ ¸å¿ƒæ¥­å‹™ï¼ˆå¦‚å³æ™‚æŸ¥è©¢ï¼‰ä¸è¢«èƒŒæ™¯ä»»å‹™ï¼ˆå¦‚å ±è¡¨åŒæ­¥ï¼‰å¡æ­»ã€‚
* **ç©©å¥çš„ SAP æ•´åˆ (Point 3):**
    ç‰¹åˆ¥æåˆ° SAP çš„ Rate limit èˆ‡ä¸Šä¸‹é™æ§åˆ¶ï¼Œé€™é¡¯ç¤ºäº†æ¥µå¼·çš„å¯¦æˆ°ç¶“é©—ã€‚SAP å¾€å¾€æ˜¯ä¼æ¥­æ¶æ§‹ä¸­æœ€è„†å¼±ä¸”æ˜‚è²´çš„ç“¶é ¸ï¼Œä¿è­·å®ƒè‡³é—œé‡è¦ã€‚

---

### 2. é—œéµé¢¨éšªèˆ‡æ‰¹åˆ¤ (Critical Review)

é€™éƒ¨åˆ†æˆ‘å°‡é‡å°ä½ æå‡ºçš„å…·é«”é»æ•¸é€²è¡ŒæŒ‘æˆ°èˆ‡æ‰¹åˆ¤ï¼Œç‰¹åˆ¥æ˜¯é—œæ–¼**ç¶²è·¯é »å¯¬**èˆ‡**è³‡æ–™ä¸€è‡´æ€§**çš„å•é¡Œã€‚

#### ğŸ”´ Point 8: ç¶²è·¯é »å¯¬ç½é›£ (The Network Bottleneck)
ä½ è¨ˆç®—äº†è³‡æ–™åŒæ­¥çš„æµé‡é¢¨éšªï¼Œé€™æ˜¯ä¸€å€‹å·¨å¤§çš„ç´…è‰²è­¦å ±ã€‚
* **ä½ çš„è¨ˆç®—ï¼š**
    $$20,000 \text{ mats} \times 2 \text{ KB} \times 246 \text{ systems} \approx 9.84 \text{ GB}$$
* **é »å¯¬é™åˆ¶ï¼š**
    Intranet (TW region) åªæœ‰ $30 \text{ Mb/s}$ã€‚
* **å‚³è¼¸æ™‚é–“ä¼°ç®—ï¼š**
    $$9.84 \text{ GB} \times 8 \text{ bits/byte} \approx 78,720 \text{ Mb}$$
    $$\frac{78,720 \text{ Mb}}{30 \text{ Mb/s}} \approx 2,624 \text{ seconds} \approx 43.7 \text{ minutes}$$
* **æ‰¹åˆ¤ï¼š** å¦‚æœé€™æ˜¯ã€Œå…¨é‡åŒæ­¥ (Full Dump)ã€ï¼Œå°‡è¿‘ 45 åˆ†é˜ä½”æ»¿é »å¯¬æ˜¯ä¸å¯æ¥å—çš„ï¼Œé€™æœƒç™±ç˜“è©²å€åŸŸçš„å…¶ä»–æ¥­å‹™ã€‚å¦‚æœé€™æ˜¯ã€Œæ¯æ—¥å¢é‡ã€ï¼Œå‰‡éœ€è©•ä¼°æ¯æ—¥è®Šæ›´ç‡ã€‚
* **å»ºè­°ï¼š**
    1.  **åš´æ ¼åŸ·è¡Œ Delta Sync (å¢é‡åŒæ­¥)ï¼š** ä¸‹æ¸¸ç³»çµ±åªæ‡‰ç²å–è®Šæ›´éƒ¨åˆ†ã€‚
    2.  **é‚Šç·£ç·©å­˜ (Edge Caching) / Multicastï¼š** ä¸è¦è®“ 246 å€‹ç³»çµ±åˆ†åˆ¥å›ç¸½éƒ¨æ‹‰å–ã€‚æ‡‰è©²åœ¨è©²å€åŸŸå»ºç«‹ä¸€å€‹ `Local Relay / Proxy`ï¼Œç¸½éƒ¨åªå‚³ä¸€ä»½æ•¸æ“šçµ¦ Relayï¼Œç”± Relay åœ¨ç•¶åœ°å±€åŸŸç¶²åˆ†ç™¼çµ¦é€™ 246 å€‹ç³»çµ±ã€‚
    3.  **å£“ç¸®ç­–ç•¥ï¼š** 2KB çš„ JSON å¯ä»¥é€é Protobuf æˆ– msgpack å£“ç¸®åˆ°æ›´å°ã€‚

#### ğŸŸ  Point 1: Elasticsearch vs. Postgres
* **æ‰¹åˆ¤ï¼š** é›–ç„¶ ES å°å…¨æ–‡æª¢ç´¢å¾ˆå¼·ï¼Œä½†ç¶­è­· ES Cluster çš„æˆæœ¬å¾ˆé«˜ï¼ˆè¨˜æ†¶é«”ã€Split Brainã€Re-indexingï¼‰ã€‚å¦‚æœä½ çš„è¤‡é›œçµæ§‹æœå°‹ä¸»è¦ä¾è³´ JSON æ¬„ä½ï¼Œç¾ä»£çš„ **PostgreSQL (with JSONB + GIN Index + pgvector)** å…¶å¯¦å·²ç¶“èƒ½æ»¿è¶³ 90% çš„éœ€æ±‚ï¼Œä¸”èƒ½ä¿è­‰ Transaction Consistency (ACID)ï¼Œæ¸›å°‘äº† "DB èˆ‡ ES è³‡æ–™ä¸åŒæ­¥" çš„å¸¸è¦‹å•é¡Œã€‚
* **æ±ºç­–é»ï¼š** é™¤éä½ éœ€è¦æ¥µé«˜ä½µç™¼çš„è®€å– (Read TPS > 10k) æˆ–æ¥µåº¦è¤‡é›œçš„æ¨¡ç³ŠåŒ¹é…ï¼Œå¦å‰‡ Postgres å¯èƒ½æ˜¯æ›´è¼•é‡ä¸”ç©©å®šçš„é¸æ“‡ã€‚


#### ğŸŸ  Point 9: NAS æ›¿æ›ç‚º Object Storage
* **æ‰¹åˆ¤ï¼š** æ–¹å‘æ­£ç¢ºï¼Œä½†éœ€æ³¨æ„ã€Œå»¶é² (Latency)ã€ã€‚NAS é€šå¸¸æ›è¼‰ç‚ºæœ¬åœ°ç£ç¢Ÿï¼Œè®€å¯«é€Ÿåº¦å¿«ï¼›Object Storage (S3/MinIO) æ˜¯ HTTP API callï¼Œæœƒæœ‰ç¶²è·¯å»¶é²ã€‚å¦‚æœä½ çš„æ‡‰ç”¨ç¨‹å¼é »ç¹è®€å¯«å°æ–‡ä»¶ï¼Œæ•ˆèƒ½æœƒä¸‹é™ã€‚
* **å»ºè­°ï¼š** ç¢ºä¿æ‡‰ç”¨å±¤æœ‰å¯¦ä½œç”± Object Storage åˆ° Local Disk çš„ **Cache æ©Ÿåˆ¶**ã€‚

#### ğŸŸ¡ Point 6: MCP Server for AI
* **é»è©•ï¼š** MCP æ˜¯ Anthropic æœ€è¿‘æ¨çš„æ¨™æº–ï¼Œéå¸¸æ–°ã€‚é›–ç„¶ç†å¿µå¾ˆå¥½ï¼Œä½†ç›®å‰ç”Ÿæ…‹ç³»æ”¯æ´åº¦å°šåœ¨æ—©æœŸã€‚å¦‚æœåœ˜éšŠå°æ­¤ä¸ç†Ÿæ‚‰ï¼Œå¯èƒ½æœƒè®Šæˆç¶­è­·é»‘æ´ã€‚ç¢ºèªé€™æ˜¯ç‚ºäº† "æ¨™æº–åŒ–" é‚„æ˜¯åƒ…åƒ…ç‚ºäº† "è·Ÿé¢¨"ã€‚

---

### 3. æ¶æ§‹è¨­è¨ˆæ€è·¯å„ªåŒ–å»ºè­° (Optimization)

#### A. è®€å¯«åˆ†é›¢ (CQRS) çš„æ·±åŒ–
åœ–ä¸­æµç¨‹ç¨å¾®æœ‰äº›æ··é›œã€‚å»ºè­°æ›´æ˜ç¢ºåœ°å°‡ã€Œå¯«å…¥/å¯©æ ¸è·¯å¾‘ã€èˆ‡ã€ŒæŸ¥è©¢è·¯å¾‘ã€åˆ†é–‹ã€‚
* **Command (Write):** é€é gRPC/API é€²å…¥ï¼Œå¯«å…¥ä¸»åº« (Postgres)ï¼Œè§¸ç™¼äº‹ä»¶ã€‚
* **Query (Read):** é€é Redis Cache æˆ– ES/Vector DB è®€å–ã€‚
* **åŒæ­¥ï¼š** åˆ©ç”¨ **CDC (Change Data Capture, e.g., Debezium)** ç›£è½ä¸»åº«çš„ WAL log ä¾†åŒæ­¥åˆ° ES å’Œä¸‹æ¸¸ Queueï¼Œè€Œä¸æ˜¯ç”± Application layer è² è²¬ç™¼é€ï¼ˆå®¹æ˜“æ‰è³‡æ–™ï¼‰ã€‚


#### B. ä¸‹æ¸¸åˆ†ç™¼å„ªåŒ– (Fan-out Optimization)
é‡å°é‚£ 246 å€‹ä¸‹æ¸¸ç³»çµ±ï¼Œå»ºè­°æ¡ç”¨ **"Pull" model æ­é… "Local Agent"**ï¼š
1.  ä¸­å¿ƒç«¯ (DC Mat) å°‡è®Šæ›´äº‹ä»¶æ¨å…¥ Kafka/Pulsarã€‚
2.  å„å€åŸŸ (Region) éƒ¨ç½²ä¸€å€‹ **Aggregator/Relay** è¨‚é–± Topicã€‚
3.  ä¸‹æ¸¸ç³»çµ±å¾ç•¶åœ°çš„ Relay æ‹‰å–è³‡æ–™ï¼Œæˆ–è€…ç”± Relay æ¨é€çµ¦ç•¶åœ°çš„ç³»çµ±ï¼Œé¿å…è·¨å€é »å¯¬ä½”ç”¨ã€‚


#### C. Mat Table Partitioning (Point 10)
* **ç­–ç•¥ï¼š** ç‰©æ–™è¡¨é€šå¸¸å»ºè­°ä¾ç…§ `Create Date` æˆ– `Category` é€²è¡Œåˆ†å€ã€‚å¦‚æœæ˜¯ç‚ºäº†æœå°‹æ•ˆèƒ½ï¼ŒPartitioning å¹«åŠ©æœ‰é™ï¼ˆé™¤éæŸ¥è©¢æ¢ä»¶å¸¶ Partition Keyï¼‰ï¼›å¦‚æœæ˜¯ç‚ºäº†ã€Œè³‡æ–™æ­¸æª” (Archiving)ã€ï¼ŒPartitioning éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ç›´æ¥ detach èˆŠè³‡æ–™åˆ†å€è½‰å…¥ Cold Storageã€‚

---

### ç¸½çµ

é€™æ˜¯ä¸€å€‹**é«˜æ°´æº–**çš„æ¶æ§‹è¨­è¨ˆï¼Œç‰¹åˆ¥æ˜¯åœ¨çµåˆ AI èˆ‡ Kubernetes è‡ªå‹•åŒ–é‹ç¶­æ–¹é¢ã€‚
ç›®å‰æœ€å¤§çš„é¢¨éšªé»åœ¨æ–¼ **Point 8 (ç¶²è·¯é »å¯¬)** å’Œ **Point 1 (ES ç¶­è­·æˆæœ¬èˆ‡è³‡æ–™ä¸€è‡´æ€§)**ã€‚

**ä¸‹ä¸€æ­¥å»ºè­°ï¼š**
Would you like me to create a specific calculation model for the bandwidth usage using "Delta Sync" assumptions, or elaborate on the "Local Relay" design to solve the 30Mb/s bottleneck?


é€™æ˜¯ä¸€å€‹éå¸¸å¥½çš„åæ€ã€‚é‡å°ä½ çš„ç–‘å•ï¼Œä»¥åŠä½ å°ã€Œä¸­æ–‡èªæ„ (CJK Support)ã€èˆ‡ã€Œæ··åˆæŸ¥è©¢ (Hybrid Search)ã€çš„è€ƒé‡ï¼Œæˆ‘çš„çµè«–æ˜¯ï¼š**åœ¨ä½ çš„å ´æ™¯ä¸‹ï¼Œå …æŒä½¿ç”¨ Elasticsearch æ˜¯æ­£ç¢ºçš„æ±ºå®šã€‚**

ä»¥ä¸‹æˆ‘å…ˆé‡å° ES vs. Postgres é€²è¡Œæ·±åº¦æŠ€è¡“åˆ†æï¼Œæ¥è‘—ç‚ºä½ ç”Ÿæˆ Mermaid æ¶æ§‹åœ–ã€‚

-----

### Part 1: ç‚ºä½•åœ¨ä½ çš„å ´æ™¯ä¸‹ Elasticsearch å„ªæ–¼ Postgresï¼Ÿ

é›–ç„¶ Postgres (PG) çš„åŠŸèƒ½è¶Šä¾†è¶Šå¼·å¤§ï¼ˆæ”¯æ´ JSONBã€GIN Indexã€pgvectorï¼‰ï¼Œä½†åœ¨é¢å°ã€Œç‰©æ–™ä¸»æ•¸æ“š (Material Master Data)ã€é€™ç¨®é«˜åº¦ä¾è³´æœå°‹é«”é©—çš„å ´æ™¯æ™‚ï¼ŒES ä¾ç„¶æ˜¯ç‹è€…ã€‚ç†ç”±å¦‚ä¸‹ï¼š

#### 1\. ä¸­æ–‡åˆ†è©èˆ‡èªæ„è™•ç† (The CJK Issue)

  * **Postgres:** åŸç”Ÿæ”¯æ´ `tsvector`ï¼Œä½†å°ä¸­æ–‡çš„åˆ†è©ï¼ˆSegmentationï¼‰æ”¯æ´è¼ƒå¼±ã€‚é›–ç„¶æœ‰ `pg_jieba` æˆ– `zhparser` ç­‰æ’ä»¶ï¼Œä½†åœ¨èª¿æ•´ã€Œåœç”¨è© (Stop words)ã€ã€ã€ŒåŒç¾©è© (Synonyms)ã€ä»¥åŠã€Œè‡ªå®šç¾©å­—å…¸ã€æ™‚ï¼Œé‹ç¶­æˆæœ¬èˆ‡éˆæ´»åº¦é ä¸å¦‚ ESã€‚
  * **Elasticsearch:** ç”Ÿæ…‹ç³»æ“æœ‰æ¥µç‚ºæˆç†Ÿçš„ Analyzerï¼ˆå¦‚ IK Analyzerï¼‰ï¼Œä¸”èƒ½è¼•é¬†è™•ç†ã€Œç¹ç°¡è½‰æ›ã€ã€ã€Œæ‹¼éŸ³æœå°‹ã€ä»¥åŠã€Œç‰¹å®šé ˜åŸŸè©åº«ï¼ˆå¦‚åŒ–å·¥ã€é›»å­æ–™ä»¶çš„å°ˆæœ‰åè©ï¼‰ã€ï¼Œé€™å° MDM ç³»çµ±è‡³é—œé‡è¦ã€‚

#### 2\. æ··åˆæŸ¥è©¢æ•ˆèƒ½ (FTS + Structured Data)

ä½ æåˆ°çš„ *"Bitmap Heap Scan"* ç“¶é ¸æ˜¯çœŸå¯¦å­˜åœ¨çš„ã€‚

  * **Postgres:** ç•¶ä½ åŸ·è¡Œ `WHERE category_id = 'A' AND description @@ 'èºçµ²'` æ™‚ï¼ŒPG éœ€è¦åˆ†åˆ¥æƒæ B-Tree ç´¢å¼•å’Œ GIN ç´¢å¼•ï¼Œç„¶å¾Œåœ¨è¨˜æ†¶é«”ä¸­åš Bitmap ANDã€‚ç•¶è³‡æ–™é‡å·¨å¤§ï¼ˆåƒè¬ç´šï¼‰ä¸” `category_id` å‘½ä¸­ç‡å¾ˆé«˜ï¼ˆLow selectivityï¼‰æ™‚ï¼Œé€™å€‹äº¤é›†é‹ç®—æœƒè®Šæ…¢ã€‚
  * **Elasticsearch:** å…¶åº•å±¤æ¶æ§‹ï¼ˆInverted Index + Bitsetï¼‰å¤©ç”Ÿå°±æ˜¯ç‚ºäº†è™•ç†é€™ç¨®äº¤é›†è¨­è¨ˆçš„ã€‚å®ƒèƒ½æ¥µå¿«åœ°åˆ©ç”¨ Filter Contextï¼ˆæœ‰ Cacheï¼‰éæ¿¾çµæ§‹åŒ–æ•¸æ“šï¼Œå†ç”¨ Query Context è™•ç†å…¨æ–‡æª¢ç´¢ã€‚

#### 3\. ç›¸é—œæ€§è©•åˆ† (Relevance Scoring - BM25)

é€™æ˜¯ PG æœ€é›£ä»¥ä¼åŠçš„ä¸€é»ã€‚

  * **å ´æ™¯:** ä½¿ç”¨è€…æœå°‹ "M3 èºçµ²"ï¼Œç³»çµ±è£¡æœ‰ "M3 ä¸é½é‹¼èºçµ²"ã€"èºçµ² M3"ã€"M30 èºçµ²"ã€‚
  * **ES:** å¯ä»¥é€é BM25 æ¼”ç®—æ³•èˆ‡æ¬Šé‡é…ç½® (Boosting)ï¼Œç²¾æº–åœ°æŠŠæœ€ç›¸é—œçš„çµæœæ’åœ¨ç¬¬ä¸€ä½ã€‚
  * **PG:** `ts_rank` åŠŸèƒ½ç›¸å°é™½æ˜¥ï¼Œå¾ˆé›£å¾®èª¿æ’åºé‚è¼¯ã€‚

**çµè«–ï¼š** æ—¢ç„¶ä½ çš„æ¶æ§‹åŒ…å« **AI Embedding** èˆ‡ **è¤‡é›œçµæ§‹æœå°‹**ï¼Œä¸”ç‰©æ–™è³‡æ–™é€šå¸¸éœ€è¦çµ¦äººé¡ï¼ˆæ¡è³¼ã€RDï¼‰æŸ¥è©¢ï¼Œ**ä¿ç•™ Elasticsearch æ˜¯æœ€å„ªè§£**ã€‚Postgres æ‡‰ä½œç‚ºã€ŒSingle Source of Truth (SSOT)ã€è² è²¬ ACID å„²å­˜ï¼ŒES ä½œç‚ºã€Œæœå°‹å¼•æ“ã€è² è²¬è®€å–åŠ é€Ÿã€‚

-----

### Part 2: ç³»çµ±æ¶æ§‹ Mermaid åœ–è¡¨

æ ¹æ“šä½ æä¾›çš„åœ–ç‰‡æè¿°ï¼Œæˆ‘å°‡å…¶è½‰æ›ç‚ºæ¨™æº–çš„ Mermaid æµç¨‹åœ–ã€‚æˆ‘å°‡æ¶æ§‹åˆ†ç‚º **Core MDM (ç¸½éƒ¨)**ã€**Search & AI**ã€**Replication/Outbound** èˆ‡ **Local/Downstream (é‚Šç·£/ä¸‹æ¸¸)** å››å€‹å€åŸŸä»¥ä¾¿é–±è®€ã€‚

```mermaid
flowchart TD
    %% å®šç¾©æ¨£å¼
    classDef storage fill:#f9f,stroke:#333,stroke-width:2px;
    classDef service fill:#bbf,stroke:#333,stroke-width:2px;
    classDef queue fill:#ff9,stroke:#333,stroke-width:2px;
    classDef external fill:#ddd,stroke:#333,stroke-dasharray: 5 5;
    classDef ai fill:#d4f1f4,stroke:#333,stroke-width:2px;

    %% --- 1. Core MDM (ç¸½éƒ¨æ ¸å¿ƒ) ---
    subgraph Core_MDM [Core MDM Domain]
        direction TB
        AppSystem[BU Mat Code System] -->|Req| MatAppService[Mat Application Service]
        HumanUser((User/Admin)) -->|Create/Modify| MatAppService
        
        MatAppService -->|2. Write| MatValues[Mat Values Storage]
        MatAppService -->|Approve Flow| ApproveProcess{Approve}
        
        MaintainOps((Maintainer)) -->|Config| Rules[Mat Code Rule / Brand / List Group]
        MaintainOps -->|Config| PriorityRule[Priority Rule]
        
        %% æ ¸å¿ƒå¯«å…¥æœå‹™
        MatCreateService[Mat Service - Create/Update]:::service
        ApproveProcess -->|Approved| MatCreateService
        MatCreateService -->|3. Write| DB_Mat[(Primary DB: Mat)]:::storage
    end

    %% --- 2. Search & AI Layer ---
    subgraph Search_AI [Search & Intelligence]
        direction TB
        %% AI éƒ¨ä»¶
        LLM[LLM Model]:::ai
        MCP[HTTP MCP Server]:::ai
        AIAgent((AI Agent)):::ai
        EmbedModel[AI Embedding Model]:::ai
        
        AIAgent --> MCP --> MatAppService
        LLM --> AIAgent
        
        %% ç´¢å¼•æµç¨‹
        DB_Mat -->|Sync/Vectorize| VectorizeProcess[Vectorize]
        VectorizeProcess --> EmbedModel
        EmbedModel --> Index_ES
        
        %% æŸ¥è©¢æœå‹™
        QueryService[Mat Service - Query API]:::service
        Index_ES[(Elasticsearch / Vector Index)]:::storage
        
        MatCreateService -->|2. Write| Index_ES
        QueryService -->|1. Search/Semantic| Index_ES
        QueryService -->|2. Get Detail| DB_Mat
        
        %% ä¸‹æ¸¸æŸ¥è©¢
        DownstreamFetch[Downstream System Fetch] --> QueryService
    end

    %% --- 3. Replication & Outbound ---
    subgraph Replication [Replication & Outbound]
        direction TB
        %% è§¸ç™¼è¤‡è£½
        MatCreateService -->|4. Send| RepQueue[Replicate Queue]:::queue
        RepService[Replicate Service]:::service
        RepQueue -->|1. Read| RepService
        
        %% å‚™ä»½èˆ‡æ¸…ç†
        DC_Mat[(DC Mat Backup)]:::storage
        RepService -->|3. Write| DC_Mat
        
        PurgeService[Mat Service - Purge]:::service
        PurgeService -->|Delete| DC_Mat
        
        %% Outbound Queue Logic (Priority)
        OutQueuePush[Push Outbound Queue]:::queue
        OutQueuePull[Pull Outbound Queue]:::queue
        
        RepService -->|4. Broadcast| OutQueuePush
        RepService -->|4. Broadcast| OutQueuePull
        
        %% æ‰“åŒ…æœå‹™
        PackService[Mat Service - Outbound Data Pack]:::service
        TempFile[Temp Outbound File/Data]:::storage
        
        OutQueuePush & OutQueuePull -->|1. Read| PackService
        PackService -->|3. Write| TempFile
        
        %% å¤–éƒ¨ API
        OutboundAPI[Mat Service - Outbound API]:::service
        TempFile --> OutboundAPI
    end

    %% --- 4. Local / Edge Layer ---
    subgraph Local_Edge [Local / Downstream Region]
        direction TB
        LocalMatService[Local Mat Service]:::service
        LocalTemp[Local Temp File/Data]:::storage
        LocalDownstream[Local Downstream System]:::external
        
        OutboundAPI -->|Fetch/Sync| LocalMatService
        LocalMatService --> LocalTemp
        LocalTemp --> LocalDownstream
    end

    %% é€£ç·šé—œä¿‚è£œå¼·
    MatAppService -.-> Rules
    MatValues -.-> MatAppService
    QueryService -.-> SAP[SAP Middleware Service]
    SAP -.-> RateLimit[Rate Limit Control]

```

### å°æ‡‰ä½ çš„è¨­è¨ˆåœ–çš„é—œéµè½‰è­¯èªªæ˜ï¼š

1.  **å·¦ä¸Šè§’ (Application):** å°æ‡‰ä½ çš„ `mat values applications` å’Œ `bu mat code system`ï¼ŒåŒ¯èšåˆ° `Mat Application Service`ã€‚
2.  **ä¸­é–“æ ¸å¿ƒ (Core):** `Mat Service - Create/Update` æ˜¯æ ¸å¿ƒå¯«å…¥é»ï¼Œå®ƒåŒæ™‚è² è²¬å¯«å…¥ Primary DB (`mat`) å’Œç™¼é€è¨Šæ¯çµ¦ `Replicate Queue`ã€‚
3.  **å³ä¸Šè§’ (AI/Search):** åŒ…å«äº† `MCP Server`ã€`AI Agent` ä»¥åŠæœ€é‡è¦çš„ `Elasticsearch` (å« Vectorize æµç¨‹)ã€‚é€™è£¡æ¸…æ¥šå±•ç¤ºäº†æŸ¥è©¢ (Query) æ™‚æœƒå„ªå…ˆæŸ¥ ESï¼Œå†å›æŸ¥ DBã€‚
4.  **ä¸‹æ–¹ (Outbound):** é€™æ˜¯æœ€è¤‡é›œçš„ä¸€å¡Šã€‚æˆ‘å°‡ `Replicate Service` ä½œç‚ºåˆ†ç™¼ä¸­å¿ƒï¼Œå¾€ä¸‹å¯«å…¥ `DC Mat`ï¼Œå¾€å³å»£æ’­åˆ° `Priority Queues` (Push/Pull)ï¼Œæœ€å¾Œé€é `Outbound API` ä¾› `Local Mat Service` æ‹‰å–ã€‚

**ä¸‹ä¸€æ­¥å»ºè­°ï¼š**
é€™å¼µ Mermaid åœ–è¡¨å¯ä»¥ç›´æ¥åµŒå…¥ Notionã€GitHub Readme æˆ– Obsidian ä¸­ä½¿ç”¨ã€‚å¦‚æœæ‚¨éœ€è¦é‡å° **"Replication & Outbound"** é€™éƒ¨åˆ†ï¼ˆç‰¹åˆ¥æ˜¯è§£æ±º 30Mb/s é »å¯¬å•é¡Œçš„ Local Relay è¨­è¨ˆï¼‰é€²è¡Œæ›´è©³ç´°çš„ç´°åŒ–è¨­è¨ˆåœ–ï¼Œæˆ‘å¯ä»¥ç‚ºæ‚¨ç¹ªè£½å°ˆé–€é‡å°è³‡æ–™åŒæ­¥æ©Ÿåˆ¶çš„ Sequence Diagramã€‚

