


```bash
#!/bin/bash

# Usage: ./create_gitlab_var.sh <project_id> <var_name> <var_value> [scope] [protected] [masked]
# Example: ./create_gitlab_var.sh 920 MY_VAR "secret_value" "*" true false

# GitLab API details
GITLAB_URL="https://gitlab.com"  # Change to your self-hosted GitLab URL if needed
GITLAB_TOKEN="${GITLAB_TOKEN}"  # Set this env var with your token

# Check if token is set
if [ -z "$GITLAB_TOKEN" ]; then
echo "Error: GITLAB_TOKEN environment variable is not set. Please set it with your GitLab token."
exit 1
fi

# Arguments
PROJECT_ID="$1"
VAR_NAME="$2"
VAR_VALUE="$3"
SCOPE="${4:-*}"  # Default to all environments
PROTECTED="${5:-false}"  # Default to not protected
MASKED="${6:-false}"  # Default to not masked

# Validate required args
if [ -z "$PROJECT_ID" ] || [ -z "$VAR_NAME" ] || [ -z "$VAR_VALUE" ]; then
echo "Usage: $0 <project_id> <var_name> <var_value> [scope] [protected] [masked]"
exit 1
fi

# API endpoint
API_URL="${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/variables"

# JSON payload
PAYLOAD=$(cat <<EOF
{
"key": "${VAR_NAME}",
"value": "${VAR_VALUE}",
"protected": ${PROTECTED},
"masked": ${MASKED},
"environment_scope": "${SCOPE}"
}
EOF
)

# Make the API call
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" -X POST "${API_URL}" \
-H "PRIVATE-TOKEN: ${GITLAB_TOKEN}" \
-H "Content-Type: application/json" \
-d "${PAYLOAD}")

# Check response
if [ "$RESPONSE" -eq 201 ]; then
echo "Success: Variable '${VAR_NAME}' created in project ${PROJECT_ID}."
elif [ "$RESPONSE" -eq 400 ]; then
echo "Error: Bad request. Check your inputs (e.g., variable name might be invalid)."
elif [ "$RESPONSE" -eq 403 ]; then
echo "Error: Forbidden. Check your token permissions."
elif [ "$RESPONSE" -eq 404 ]; then
echo "Error: Project not found or API endpoint incorrect."
else
echo "Error: Unexpected response code ${RESPONSE}. Check GitLab API docs."
fi
```



```bash
#!/bin/bash

export SONAR_HOST=
export TOKEN=
export PROJECT_KEY=
export GITLAB_TOKEN=
export PROJECT_ID=
export "NAME=Security Rating"
export METRIC=security_rating
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Bugs"
export METRIC=bugs
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Duplicated lines density"
export METRIC=duplicated_lines_density
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Coverage"
export METRIC=coverage
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Duplicated Lines (%)"
export METRIC=duplicated_lines_density
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Lines of Code"
export METRIC=ncloc
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Maintainability Rating"
export METRIC=sqale_rating
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Quality Gate Status"
export METRIC=alert_status
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Reliability Rating"
export METRIC=reliability_rating
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Security Hotspots"
export METRIC=security_hotspots
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Security Rating"
export METRIC=security_rating
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Technical Debt"
export METRIC=sqale_index
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"
export "NAME=Vulnerabilities"
export METRIC=vulnerabilities
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$NAME&link_url=https://$SONAR_HOST/dashboard?id=$PROJECT_KEY&image_url=https://$SONAR_HOST/api/project_badges/measure?project%3D$PROJECT_KEY%26metric%3D$METRIC%26token%3D$TOKEN" \
     "https://pcggit.pouchen.com/api/v4/projects/$PROJECT_ID/badges"

```


```sh
GITLAB_TOKEN=
PROJECT_ID=
PROJECT_BADGE_NAME=
ARGOCD_HOST=
ARGOCD_APP=
curl --request POST --header "PRIVATE-TOKEN: $GITLAB_TOKEN" \
     --data "name=$PROJECT_BADGE_NAME&image_url=https://$ARGOCD_HOST/api/badge?name=$ARGOCD_APP%26revision%3Dtrue%26showAppName%3Dtrue&link_url=https://$ARGOCD_HOST/applications/argocd/$ARGOCD_APP" \
     "https://gitlab.com/api/v4/projects/$PROJECT_ID/badges"
```
