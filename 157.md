


```bash
#!/bin/bash

# Usage: ./create_gitlab_var.sh <project_id> <var_name> <var_value> [scope] [protected] [masked]
# Example: ./create_gitlab_var.sh 920 MY_VAR "secret_value" "*" true false

# GitLab API details
GITLAB_URL="https://gitlab.com"  # Change to your self-hosted GitLab URL if needed
GITLAB_TOKEN="${GITLAB_TOKEN}"  # Set this env var with your token

# Check if token is set
if [ -z "$GITLAB_TOKEN" ]; then
echo "Error: GITLAB_TOKEN environment variable is not set. Please set it with your GitLab token."
exit 1
fi

# Arguments
PROJECT_ID="$1"
VAR_NAME="$2"
VAR_VALUE="$3"
SCOPE="${4:-*}"  # Default to all environments
PROTECTED="${5:-false}"  # Default to not protected
MASKED="${6:-false}"  # Default to not masked

# Validate required args
if [ -z "$PROJECT_ID" ] || [ -z "$VAR_NAME" ] || [ -z "$VAR_VALUE" ]; then
echo "Usage: $0 <project_id> <var_name> <var_value> [scope] [protected] [masked]"
exit 1
fi

# API endpoint
API_URL="${GITLAB_URL}/api/v4/projects/${PROJECT_ID}/variables"

# JSON payload
PAYLOAD=$(cat <<EOF
{
"key": "${VAR_NAME}",
"value": "${VAR_VALUE}",
"protected": ${PROTECTED},
"masked": ${MASKED},
"environment_scope": "${SCOPE}"
}
EOF
)

# Make the API call
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" -X POST "${API_URL}" \
-H "PRIVATE-TOKEN: ${GITLAB_TOKEN}" \
-H "Content-Type: application/json" \
-d "${PAYLOAD}")

# Check response
if [ "$RESPONSE" -eq 201 ]; then
echo "Success: Variable '${VAR_NAME}' created in project ${PROJECT_ID}."
elif [ "$RESPONSE" -eq 400 ]; then
echo "Error: Bad request. Check your inputs (e.g., variable name might be invalid)."
elif [ "$RESPONSE" -eq 403 ]; then
echo "Error: Forbidden. Check your token permissions."
elif [ "$RESPONSE" -eq 404 ]; then
echo "Error: Project not found or API endpoint incorrect."
else
echo "Error: Unexpected response code ${RESPONSE}. Check GitLab API docs."
fi
```
